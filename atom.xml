<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Aaron Chan&#39;s Blog</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-03-05T05:47:11.172Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Aaron</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android 6.0运行时权限完全解析</title>
    <link href="http://yoursite.com/2016/03/05/AndroidRuntimePermissions/"/>
    <id>http://yoursite.com/2016/03/05/AndroidRuntimePermissions/</id>
    <published>2016-03-05T04:32:12.000Z</published>
    <updated>2016-03-05T05:47:11.172Z</updated>
    
    <content type="html">&lt;h2 id=&quot;1-引子&quot;&gt;&lt;a href=&quot;#1-引子&quot; class=&quot;headerlink&quot; title=&quot;1. 引子&quot;&gt;&lt;/a&gt;1. 引子&lt;/h2&gt;&lt;p&gt;Android自诞生以来，其安全性一直被人们所诟病。加之，国内&lt;code&gt;安卓&lt;/code&gt;App生态环境恶劣，只要是个应用，恨不得申请所有权限。谷歌或许也意识到这个问题，因此在&lt;a href=&quot;https://www.android.com/versions/marshmallow-6-0/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Marshmallow&lt;/a&gt;包含了期待已久的运行时权限管理。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-M时代之前&quot;&gt;&lt;a href=&quot;#2-M时代之前&quot; class=&quot;headerlink&quot; title=&quot;2. M时代之前&quot;&gt;&lt;/a&gt;2. M时代之前&lt;/h2&gt;&lt;p&gt;在Android 6.0之前，一个应用所需要的权限会在安装的时候列出，如果用户想安装这个应用，只能全盘接受。国内应用一般都是权限毒瘤，这一直以来都是安卓用户的痛中之痛。主要体现在两点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;无法动态授权&lt;/li&gt;
&lt;li&gt;无法知道应用什么时候使用了权限&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果M之前的代码不加修改，直接跑在M手机上，可能导致应用崩溃。&lt;/p&gt;
&lt;h2 id=&quot;3-M时代&quot;&gt;&lt;a href=&quot;#3-M时代&quot; class=&quot;headerlink&quot; title=&quot;3. M时代&quot;&gt;&lt;/a&gt;3. M时代&lt;/h2&gt;&lt;p&gt;Android中的权限分为两大类：普通权限和危险权限，具体可以参考&lt;a href=&quot;http://developer.android.com/intl/zh-cn/guide/topics/security/permissions.html#normal-dangerous&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;开发文档&lt;/a&gt;。在M手机上，对于敏感权限，需要在程序运行时进行动态申请。对于非敏感权限，即&lt;a href=&quot;http://developer.android.com/guide/topics/security/normal-permissions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Normal Permissions&lt;/a&gt;，和M之前的使用相同。&lt;/p&gt;
&lt;h3 id=&quot;3-1-场景拆分&quot;&gt;&lt;a href=&quot;#3-1-场景拆分&quot; class=&quot;headerlink&quot; title=&quot;3.1 场景拆分&quot;&gt;&lt;/a&gt;3.1 场景拆分&lt;/h3&gt;&lt;p&gt;首先，上效果图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/AaronChanSunny/AndroidRuntimePermissions/blob/master/screenshot/clip.gif?raw=true&quot; alt=&quot;Runtime gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;场景拆解：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;应用首次请求权限，系统弹出授权对话框（系统级，不可定制），包含&lt;code&gt;允许&lt;/code&gt;和&lt;code&gt;拒绝&lt;/code&gt;两个按钮。如果用户点击&lt;code&gt;允许&lt;/code&gt;，应用拿到相应权限，如果点击&lt;code&gt;拒绝&lt;/code&gt;，则进入下一个场景。&lt;/li&gt;
&lt;li&gt;当上次授权用户点击&lt;code&gt;拒绝&lt;/code&gt;，应用再次申请权限时，可以定制一个提示信息给用户，引导用户授权。例如效果图中的对话框，当用户点击&lt;code&gt;确定&lt;/code&gt;，应用再次发起授权；若点击&lt;code&gt;取消&lt;/code&gt;，授权中断。&lt;/li&gt;
&lt;li&gt;从应用请求第二次授权开始，授权对话框会多出一个&lt;code&gt;不再弹出&lt;/code&gt;的复选框。如果用户选中复选框，应用每次请求授权得到的授权结果都是&lt;strong&gt;拒绝&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;接下来，让我们看看具体的实现细节。&lt;/p&gt;
&lt;h3 id=&quot;3-2-请求权限&quot;&gt;&lt;a href=&quot;#3-2-请求权限&quot; class=&quot;headerlink&quot; title=&quot;3.2 请求权限&quot;&gt;&lt;/a&gt;3.2 请求权限&lt;/h3&gt;&lt;p&gt;这里以最简单的电话权限举例。首先，需要在&lt;code&gt;AndroidManifest.xml&lt;/code&gt;中声明&lt;code&gt;android.permission.CALL_PHONE&lt;/code&gt;权限：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;uses-permission android:name=&amp;quot;android.permission.CALL_PHONE&amp;quot;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;接下来，在Activity中，使用&lt;a href=&quot;http://developer.android.com/reference/android/support/v4/content/ContextCompat.html#checkSelfPermission(android.content.Context, java.lang.String&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ContextCompat.checkSelfPermission()&lt;/a&gt;)检查该权限是否授权，如果没有被授权，使用&lt;a href=&quot;http://developer.android.com/reference/android/support/v4/app/ActivityCompat.html#requestPermissions(android.app.Activity, java.lang.String[], int&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;requestPermissions()&lt;/a&gt;)进行权限申请。需要为每一个权限指定一个id，当系统返回授权结果时，应用根据id拿到授权结果。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;if (ContextCompat.checkSelfPermission(this, android.Manifest.permission&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .CALL_PHONE) != PackageManager.PERMISSION_GRANTED) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ActivityCompat.requestPermissions(MainActivity.this, new&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String[]&amp;#123;android.Manifest.permission.CALL_PHONE&amp;#125;, REQUEST_PERMISSION_CALL_PHONE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Log.d(TAG, &amp;quot;call phone permission granted.&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    startActivity(intent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-3-授权回调&quot;&gt;&lt;a href=&quot;#3-3-授权回调&quot; class=&quot;headerlink&quot; title=&quot;3.3 授权回调&quot;&gt;&lt;/a&gt;3.3 授权回调&lt;/h3&gt;&lt;p&gt;当应用申请权限后，Activity将触发一个回调&lt;a href=&quot;http://developer.android.com/reference/android/support/v4/app/ActivityCompat.OnRequestPermissionsResultCallback.html#onRequestPermissionsResult(int, java.lang.String[], int[]&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;onRequestPermissionsResult()&lt;/a&gt;)，告诉应用用户的授权结果。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (requestCode == REQUEST_PERMISSION_CALL_PHONE) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (grantResults[0] == PackageManager.PERMISSION_GRANTED) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            call10086();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Toast.makeText(this, &amp;quot;Permission denied.&amp;quot;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    super.onRequestPermissionsResult(requestCode, permissions, grantResults);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-4-授权提示&quot;&gt;&lt;a href=&quot;#3-4-授权提示&quot; class=&quot;headerlink&quot; title=&quot;3.4 授权提示&quot;&gt;&lt;/a&gt;3.4 授权提示&lt;/h3&gt;&lt;p&gt;当应用首次申请权限时，如果用户点击拒绝，下次再申请权限，Android允许你提示用户，你为什么需要这个权限，好引导用户是否授权。这个功能通过&lt;a href=&quot;http://developer.android.com/reference/android/support/v4/app/ActivityCompat.html#shouldShowRequestPermissionRationale(android.app.Activity, java.lang.String&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shouldShowRequestPermissionRationale()&lt;/a&gt;)实现。例如，可以弹出一个对话框提示用户：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;if (ActivityCompat.shouldShowRequestPermissionRationale(this, Manifest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .permission.CALL_PHONE)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AlertDialog.Builder builder = new AlertDialog.Builder(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    builder.setTitle(&amp;quot;说明&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setMessage(&amp;quot;需要使用电话权限，进行电话测试&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setPositiveButton(&amp;quot;确定&amp;quot;, new DialogInterface.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                public void onClick(DialogInterface dialog, int which) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ActivityCompat.requestPermissions(MainActivity.this, new&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            String[]&amp;#123;android.Manifest.permission.CALL_PHONE&amp;#125;, REQUEST_PERMISSION_CALL_PHONE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setNegativeButton(&amp;quot;取消&amp;quot;, new DialogInterface.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                public void onClick(DialogInterface dialog, int which) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .create()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ActivityCompat.requestPermissions(this, new String[]&amp;#123;android&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .Manifest.permission.CALL_PHONE&amp;#125;, REQUEST_PERMISSION_CALL_PHONE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果用户点击对话框&lt;code&gt;取消&lt;/code&gt;按钮，授权结果；如果点击&lt;code&gt;确定&lt;/code&gt;按钮，再次申请权限。具体交互可以看效果图。完整代码请戳&lt;a href=&quot;AndroidRuntimePermissions/app/src/main/java/com/aaron/androidruntimepermissions/MainActivity.java&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;4-轮子&quot;&gt;&lt;a href=&quot;#4-轮子&quot; class=&quot;headerlink&quot; title=&quot;4 轮子&quot;&gt;&lt;/a&gt;4 轮子&lt;/h2&gt;&lt;p&gt;通过上面讲解，大家也可以看出，虽然动态权限的编码逻辑简单，涉及的Api也就几个。但由于申请权限的位置和授权结果回调分别在两个地方，给人的感觉就一个字&lt;strong&gt;乱&lt;/strong&gt;；并且，如果Activity规模较大、需要申请权限较多时，代码就会变得混乱。针对这些，前辈们封装了许多&lt;a href=&quot;https://gist.github.com/dlew/2a21b06ee8715e0f7338&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;动态权限第三方库&lt;/a&gt;，这里拿&lt;a href=&quot;https://github.com/hotchemi/PermissionsDispatcher&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;PermissionsDispatcher&lt;/a&gt;进行说明。PermissionsDispatcher具有如下优点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;采用注解，代码形式简洁；&lt;/li&gt;
&lt;li&gt;PermissionsDispatcher采用编译时生成代理类，让Activity/Fragment调用。因此，在效率上和官方写法没有区别。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;4-1-配置依赖&quot;&gt;&lt;a href=&quot;#4-1-配置依赖&quot; class=&quot;headerlink&quot; title=&quot;4.1 配置依赖&quot;&gt;&lt;/a&gt;4.1 配置依赖&lt;/h3&gt;&lt;p&gt;在工程&lt;code&gt;build.gradle&lt;/code&gt;文件加入依赖：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;buildscript &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        classpath &amp;apos;com.neenbedankt.gradle.plugins:android-apt:1.8&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在&lt;code&gt;app/build.gradle&lt;/code&gt;加入依赖：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apply plugin: &amp;apos;android-apt&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  compile &amp;apos;com.github.hotchemi:permissionsdispatcher:2.0.7&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  apt &amp;apos;com.github.hotchemi:permissionsdispatcher-processor:2.0.7&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;4-2-使用&quot;&gt;&lt;a href=&quot;#4-2-使用&quot; class=&quot;headerlink&quot; title=&quot;4.2 使用&quot;&gt;&lt;/a&gt;4.2 使用&lt;/h3&gt;&lt;p&gt;给需要动态权限的Activity或者Fragment加上注解&lt;code&gt;RuntimePermissions&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@RuntimePermissions&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public class MainActivity extends AppCompatActivity &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;给涉及到动态权限的方法加上注解&lt;code&gt;@NeedsPermission&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@RuntimePermissions&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public class MainActivity extends AppCompatActivity &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @NeedsPermission(Manifest.permission.CALL_PHONE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    void callPhone() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // Trigger the calling of a number here&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;重新编译工程&lt;/strong&gt;后，将产生一个以&lt;code&gt;PermissionsDispatcher&lt;/code&gt;为后缀的代理类，例如这里是&lt;code&gt;MainActivityPermissionsDispatcher&lt;/code&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果提示找不到&lt;code&gt;MainActivityPermissionsDispatcher&lt;/code&gt;类，说明apt代码生成失败，重启Android Studio试试。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;代理类生成后，重写权限申请回调，让代理类来处理：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    super.onRequestPermissionsResult(requestCode, permissions, grantResults);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MainActivityPermissionsDispatcher.onRequestPermissionsResult(this, REQUEST_PERMISSION_CALL_PHONE, grantResults);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;4-3-处理授权结果&quot;&gt;&lt;a href=&quot;#4-3-处理授权结果&quot; class=&quot;headerlink&quot; title=&quot;4.3 处理授权结果&quot;&gt;&lt;/a&gt;4.3 处理授权结果&lt;/h3&gt;&lt;p&gt;应用首次申请权限，用户拒绝，使用&lt;code&gt;@OnPermissionDenied&lt;/code&gt;标识的方法将作为回调：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@OnPermissionDenied(Manifest.permission.CALL_PHONE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;void showDeniedForCallPhone() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Toast.makeText(this, &amp;quot;未授权&amp;quot;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;应用首次申请权限被拒绝，再次申请权限时，给出提示信息，使用&lt;code&gt;@OnShowRationale&lt;/code&gt;注解标识：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@OnShowRationale(Manifest.permission.CALL_PHONE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;void showRationaleForCallPhone(final PermissionRequest request) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    new AlertDialog.Builder(this)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setTitle(&amp;quot;提示&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setMessage(&amp;quot;需要授权电话权限&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setNegativeButton(&amp;quot;取消&amp;quot;, new DialogInterface.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                public void onClick(DialogInterface dialog, int which) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    request.cancel();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setPositiveButton(&amp;quot;确定&amp;quot;, new DialogInterface.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                public void onClick(DialogInterface dialog, int which) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    request.proceed();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .create()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;应用非首次申请权限时，授权对话框会多出一个复选框&lt;code&gt;不再询问&lt;/code&gt;，相应回调方法用&lt;code&gt;@OnNeverAskAgain&lt;/code&gt;标识：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@OnNeverAskAgain(Manifest.permission.CALL_PHONE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;void showNeverAskForPhoneCall() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Toast.makeText(this, &amp;quot;不再询问&amp;quot;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;完整代码请戳&lt;a href=&quot;https://github.com/AaronChanSunny/AndroidRuntimePermissions/blob/feature/dispatcher/app/src/main/java/com/aaron/androidruntimepermissions/MainActivity.java&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&quot;4-4-原理&quot;&gt;&lt;a href=&quot;#4-4-原理&quot; class=&quot;headerlink&quot; title=&quot;4.4 原理&quot;&gt;&lt;/a&gt;4.4 原理&lt;/h3&gt;&lt;p&gt;PermissionsDispatcher在编译时，会为需要申请运行时权限的每个Activity或者Fragment都生成一个相应的代理类。这个代理类非常简单，这里贴一下代码：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// This file was generated by PermissionsDispatcher. Do not modify!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;package com.aaron.androidruntimepermissions;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.support.v4.app.ActivityCompat;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import java.lang.Override;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import java.lang.String;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import java.lang.ref.WeakReference;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import permissions.dispatcher.PermissionRequest;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import permissions.dispatcher.PermissionUtils;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;final class MainActivityPermissionsDispatcher &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  private static final int REQUEST_CALL10086 = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  private static final String[] PERMISSION_CALL10086 = new String[] &amp;#123;&amp;quot;android.permission.CALL_PHONE&amp;quot;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  private MainActivityPermissionsDispatcher() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  static void call10086WithCheck(MainActivity target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (PermissionUtils.hasSelfPermissions(target, PERMISSION_CALL10086)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      target.call10086();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (PermissionUtils.shouldShowRequestPermissionRationale(target, PERMISSION_CALL10086)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target.showRationaleForCallPhone(new Call10086PermissionRequest(target));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ActivityCompat.requestPermissions(target, PERMISSION_CALL10086, REQUEST_CALL10086);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  static void onRequestPermissionsResult(MainActivity target, int requestCode, int[] grantResults) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    switch (requestCode) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      case REQUEST_CALL10086:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (PermissionUtils.getTargetSdkVersion(target) &amp;lt; 23 &amp;amp;&amp;amp; !PermissionUtils.hasSelfPermissions(target, PERMISSION_CALL10086)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target.showDeniedForCallPhone();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (PermissionUtils.verifyPermissions(grantResults)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target.call10086();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (!PermissionUtils.shouldShowRequestPermissionRationale(target, PERMISSION_CALL10086)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          target.showNeverAskForPhoneCall();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          target.showDeniedForCallPhone();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      break;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      default:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      break;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  private static final class Call10086PermissionRequest implements PermissionRequest &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private final WeakReference&amp;lt;MainActivity&amp;gt; weakTarget;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private Call10086PermissionRequest(MainActivity target) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      this.weakTarget = new WeakReference&amp;lt;&amp;gt;(target);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void proceed() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      MainActivity target = weakTarget.get();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (target == null) return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ActivityCompat.requestPermissions(target, PERMISSION_CALL10086, REQUEST_CALL10086);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void cancel() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      MainActivity target = weakTarget.get();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      if (target == null) return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      target.showDeniedForCallPhone();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;动态授权，对于一些流氓应用是十分有必要的。但是，有些超级流氓，如果你不授权就直接退出应用，也是无奈，比如某宝…&lt;/li&gt;
&lt;li&gt;如果Activity规模较大、需要申请权限较多时，代码就会变得混乱。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;针对第二点，前辈们封装了不少库，大家可以根据项目需要进行选择。&lt;/p&gt;
&lt;p&gt;完整示例代码，请移步&lt;a href=&quot;https://github.com/AaronChanSunny/AndroidRuntimePermissions&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://developer.android.com/training/permissions/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Working with System Permissions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://developer.android.com/training/permissions/requesting.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Requesting Permissions at Run Time&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/codepath/android_guides/wiki/Managing-Runtime-Permissions-with-PermissionsDispatcher&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Managing Runtime Permissions with PermissionsDispatcher&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-引子&quot;&gt;&lt;a href=&quot;#1-引子&quot; class=&quot;headerlink&quot; title=&quot;1. 引子&quot;&gt;&lt;/a&gt;1. 引子&lt;/h2&gt;&lt;p&gt;Android自诞生以来，其安全性一直被人们所诟病。加之，国内&lt;code&gt;安卓&lt;/code&gt;App生态环境恶劣，只要是个应用，恨不得申请所有权限。谷歌或许也意识到这个问题，因此在&lt;a href=&quot;https://www.android.com/versions/marshmallow-6-0/&quot;&gt;Marshmallow&lt;/a&gt;包含了期待已久的运行时权限管理。
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android异步加载数据伴侣，TaskLoader与LoaderManager</title>
    <link href="http://yoursite.com/2016/03/05/AndroidLoaders/"/>
    <id>http://yoursite.com/2016/03/05/AndroidLoaders/</id>
    <published>2016-03-05T04:18:05.000Z</published>
    <updated>2016-03-05T05:47:11.171Z</updated>
    
    <content type="html">&lt;h2 id=&quot;1-前面的话&quot;&gt;&lt;a href=&quot;#1-前面的话&quot; class=&quot;headerlink&quot; title=&quot;1 前面的话&quot;&gt;&lt;/a&gt;1 前面的话&lt;/h2&gt;&lt;p&gt;App大部分的业务场景是这样：从服务端拉取数据，返回结果后进行展示。Android中，每一个界面都是由Activity或者Fragment托管的，通常情况下，业务的逻辑和生命周期强耦合。很多时候，我们需要决定什么时候拉取数据，什么时候使用缓存数据。例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首次进入页面&lt;/li&gt;
&lt;li&gt;设备&lt;a href=&quot;http://developer.android.com/guide/topics/resources/runtime-changes.html?utm_campaign=adp_series_loaders_020216&amp;amp;utm_source=medium&amp;amp;utm_medium=blog&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;配置发生变化&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以上两种情况，拉取数据的策略是不同的。我们希望在首次进入页面的时候进行数据拉取，但是当配置发生变化时，直接使用上次请求得到的数据。那么，有没有一种较为优雅的解决方案？有的，那就是&lt;a href=&quot;http://developer.android.com/guide/components/loaders.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Loaders&lt;/a&gt;。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-认识Loaders&quot;&gt;&lt;a href=&quot;#2-认识Loaders&quot; class=&quot;headerlink&quot; title=&quot;2 认识Loaders&quot;&gt;&lt;/a&gt;2 认识Loaders&lt;/h2&gt;&lt;p&gt;使用Loaders可以大大简化Activity或者Fragment加载异步数据。引用官方一句话：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Loaders make it easy to asynchronously load data in an activity or fragment. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;谈到异步任务，最基础的莫过于Handler了。但是Handler在实际过程中较为复杂，编写的代码可读性也较差。Android为了降低异步编程的复杂度，引入了&lt;a href=&quot;http://developer.android.com/reference/android/os/AsyncTask.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AsyncTask&lt;/a&gt;。Loaders的设计目的也是为了简化数据的异步操作，并且，在使用上和AsyncTask十分相似。它具有如下特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;They are available to every Activity and Fragment.（就地取材）&lt;/li&gt;
&lt;li&gt;They provide asynchronous loading of data.（用途）&lt;/li&gt;
&lt;li&gt;They monitor the source of their data and deliver new results when the content changes.（感知数据变化）&lt;/li&gt;
&lt;li&gt;They automatically reconnect to the last loader’s cursor when being recreated after a configuration change. Thus, they don’t need to re-query their data.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Loaders的强大之处在于后面2点。如果对每个数据源编写对应&lt;code&gt;Observer&lt;/code&gt;，当数据源发生变化时，可以通知Loaders重新加载数据；手机发生转屏导致Activity或者Fragment重建，Loaders可以直接使用上次请求的结果，而不需要再次请求。&lt;/p&gt;
&lt;h2 id=&quot;3-使用它&quot;&gt;&lt;a href=&quot;#3-使用它&quot; class=&quot;headerlink&quot; title=&quot;3 使用它&quot;&gt;&lt;/a&gt;3 使用它&lt;/h2&gt;&lt;p&gt;使用Loaders做数据异步加载，包括两部分：指定TaskLoader，使用LoaderManager管理TaskLoader。&lt;/p&gt;
&lt;h3 id=&quot;3-1-定义TaskLoader&quot;&gt;&lt;a href=&quot;#3-1-定义TaskLoader&quot; class=&quot;headerlink&quot; title=&quot;3.1 定义TaskLoader&quot;&gt;&lt;/a&gt;3.1 定义TaskLoader&lt;/h3&gt;&lt;p&gt;官方&lt;a href=&quot;http://developer.android.com/guide/components/loaders.html#example&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;例子&lt;/a&gt;是读取手机通讯录，这里我们使用一种更通用的场景，网络请求。当然，TaskLoader可以是任何你需要异步的操作集合。Api使用&lt;a href=&quot;https://developers.douban.com/wiki/?title=movie_v2&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;豆瓣电影&lt;/a&gt;，定义一个&lt;code&gt;InTheatersTaskLoader&lt;/code&gt;，用于请求&lt;code&gt;正在热映&lt;/code&gt;，相关代码如下：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TaskLoaderResult&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;保存异步任务结果，包括数据和异常信息。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class TaskLoaderResult&amp;lt;T&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private Exception mException;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private T mData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public TaskLoaderResult() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public TaskLoaderResult(Exception exception, T data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mException = exception;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mData = data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public Exception getException() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return mException;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void setException(Exception exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mException = exception;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public T getData() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return mData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void setData(T data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mData = data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;InTheaters&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Json对象，用于Gson序列化/反序列化。这里使用推荐Android Studio神级插件&lt;a href=&quot;https://github.com/zzz40500/GsonFormat&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GsonFormat&lt;/a&gt;进行自动生成。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class TaskLoaderResult&amp;lt;T&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private Exception mException;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private T mData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public TaskLoaderResult() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public TaskLoaderResult(Exception exception, T data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mException = exception;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mData = data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public Exception getException() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return mException;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void setException(Exception exception) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mException = exception;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public T getData() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return mData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void setData(T data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mData = data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;AsyncTaskLoader&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;所有的异步操作都应该放在这里，并负责保存结果。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class InTheatersTaskLoader extends AsyncTaskLoader&amp;lt;TaskLoaderResult&amp;lt;InTheaters&amp;gt;&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private static final String TAG = InTheatersTaskLoader.class.getSimpleName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private final Context mContext;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private TaskLoaderResult&amp;lt;InTheaters&amp;gt; mResult;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public InTheatersTaskLoader(Context context) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super(context);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mContext = context;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    protected void onStartLoading() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(TAG, &amp;quot;onStartLoading, mResult &amp;quot; + mResult);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super.onStartLoading();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (mResult != null &amp;amp;&amp;amp; mResult.getData() != null) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            deliverResult(mResult);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            forceLoad();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public TaskLoaderResult&amp;lt;InTheaters&amp;gt; loadInBackground() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(TAG, &amp;quot;thread &amp;quot; + Thread.currentThread().getId());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TaskLoaderResult&amp;lt;InTheaters&amp;gt; result = new TaskLoaderResult&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ApiService api = ApiProvider.getInstance(mContext).getApiService();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Call&amp;lt;InTheaters&amp;gt; call = api.getInTheaters(&amp;quot;福州&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result.setData(call.execute().body());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; catch (IOException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            result.setException(e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void deliverResult(TaskLoaderResult&amp;lt;InTheaters&amp;gt; data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(TAG, &amp;quot;deliverResult&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mResult = data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super.deliverResult(data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里，我们就定义好了一个异步加载任务，用来从豆瓣拉取最新&lt;code&gt;正在热映&lt;/code&gt;的电影。关于Api部分的封装，使用的是Retrofit + OkHttp组合，这里就不列出代码了。&lt;/p&gt;
&lt;h3 id=&quot;3-2-使用LoaderManager管理Loader&quot;&gt;&lt;a href=&quot;#3-2-使用LoaderManager管理Loader&quot; class=&quot;headerlink&quot; title=&quot;3.2 使用LoaderManager管理Loader&quot;&gt;&lt;/a&gt;3.2 使用LoaderManager管理Loader&lt;/h3&gt;&lt;p&gt;定义好LoaderTask之后，我们还需要让外部启动它，才能完成数据加载。Android在Activity/Fragment中已经封装好了一个LoaderManager，直接调用&lt;code&gt;getLoaderManager()&lt;/code&gt;，如果需要支持v4包，则调用兼容方法&lt;code&gt;getSupportLoaderManager()&lt;/code&gt;。此外，需要让Activity/Fragment实现&lt;code&gt;LoaderManager.LoaderCallbacks&lt;/code&gt;。代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class MainActivity extends AppCompatActivity implements LoaderManager.LoaderCallbacks&amp;lt;TaskLoaderResult&amp;lt;InTheaters&amp;gt;&amp;gt;, View.OnClickListener &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private static final String TAG = MainActivity.class.getSimpleName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private ListView mListView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private ArrayAdapter&amp;lt;String&amp;gt; mAdapter;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private List&amp;lt;String&amp;gt; mData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    protected void onCreate(Bundle savedInstanceState) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.activity_main);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setSupportActionBar(toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mData = new ArrayList&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mAdapter = new ArrayAdapter&amp;lt;&amp;gt;(this, android.R.layout.simple_list_item_1, android.R&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .id.text1, mData);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mListView = (ListView) findViewById(R.id.list);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mListView.setAdapter(mAdapter);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mListView.setEmptyView(findViewById(R.id.empty_item));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        getSupportLoaderManager().initLoader(0, null, this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fab.setOnClickListener(new View.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            public void onClick(View view) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Snackbar.make(view, &amp;quot;Replace with your own action&amp;quot;, Snackbar.LENGTH_LONG)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .setAction(&amp;quot;Action&amp;quot;, null).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                getSupportLoaderManager().restartLoader(0, null, MainActivity.this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        findViewById(R.id.button).setOnClickListener(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    protected void onStop() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(TAG, &amp;quot;onStop&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super.onStop();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    protected void onDestroy() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(TAG, &amp;quot;onDestroy&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super.onDestroy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public boolean onCreateOptionsMenu(Menu menu) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // Inflate the menu; this adds items to the action bar if it is present.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        getMenuInflater().inflate(R.menu.menu_main, menu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public boolean onOptionsItemSelected(MenuItem item) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // Handle action bar item clicks here. The action bar will&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // automatically handle clicks on the Home/Up button, so long&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // as you specify a parent activity in AndroidManifest.xml.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        int id = item.getItemId();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //noinspection SimplifiableIfStatement&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (id == R.id.action_settings) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return super.onOptionsItemSelected(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public Loader&amp;lt;TaskLoaderResult&amp;lt;InTheaters&amp;gt;&amp;gt; onCreateLoader(int id, Bundle args) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(TAG, &amp;quot;onCreateLoader, id &amp;quot; + id);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return new InTheatersTaskLoader(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void onLoadFinished(Loader&amp;lt;TaskLoaderResult&amp;lt;InTheaters&amp;gt;&amp;gt; loader, TaskLoaderResult&amp;lt;InTheaters&amp;gt; data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (data.getException() != null) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Log.e(TAG, data.getException().getMessage());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        for(InTheaters.Subject subject : data.getData().getSubjects()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            mData.add(subject.getTitle());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mAdapter.addAll(mData);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mAdapter.notifyDataSetChanged();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void onLoaderReset(Loader&amp;lt;TaskLoaderResult&amp;lt;InTheaters&amp;gt;&amp;gt; loader) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Log.d(TAG, &amp;quot;onLoaderReset&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mAdapter.clear();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mAdapter.notifyDataSetChanged();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public void onClick(View v) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (v.getId() == R.id.button) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            startActivity(new Intent(this, FooActivity.class));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;4-总结&quot;&gt;&lt;a href=&quot;#4-总结&quot; class=&quot;headerlink&quot; title=&quot;4 总结&quot;&gt;&lt;/a&gt;4 总结&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;多个LoaderTask &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果一个Activity有多个LoaderTask，由于LoaderTask的id和处理的数据类型都不同，则需要为每个LoaderTask定义一个回调。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;异常处理&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;网络请求都包含异常处理逻辑，这里采用的是单独封装一个TaskResult类。如果抛出以异常，将异常信息set进去，并且data至为null。这时候Activity/Fragment在&lt;code&gt;onFinished()&lt;/code&gt;中需要对TaskResult进行判断，如果异常信息不为空，进入异常处理逻辑。&lt;/p&gt;
&lt;p&gt;完整示例代码，请移步&lt;a href=&quot;https://github.com/AaronChanSunny/AndroidLoaders&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;我的Github&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://developer.android.com/guide/components/loaders.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Developers API Guideds&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/google-developers/making-loading-data-on-android-lifecycle-aware-897e12760832#.rkjlbux9a&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Making loading data lifecycle aware&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.gunawan.me/2011/10/android-asynctaskloader-exception.html?m=1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android: AsyncTaskLoader Exception Handling&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-前面的话&quot;&gt;&lt;a href=&quot;#1-前面的话&quot; class=&quot;headerlink&quot; title=&quot;1 前面的话&quot;&gt;&lt;/a&gt;1 前面的话&lt;/h2&gt;&lt;p&gt;App大部分的业务场景是这样：从服务端拉取数据，返回结果后进行展示。Android中，每一个界面都是由Activity或者Fragment托管的，通常情况下，业务的逻辑和生命周期强耦合。很多时候，我们需要决定什么时候拉取数据，什么时候使用缓存数据。例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首次进入页面&lt;/li&gt;
&lt;li&gt;设备&lt;a href=&quot;http://developer.android.com/guide/topics/resources/runtime-changes.html?utm_campaign=adp_series_loaders_020216&amp;amp;utm_source=medium&amp;amp;utm_medium=blog&quot;&gt;配置发生变化&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以上两种情况，拉取数据的策略是不同的。我们希望在首次进入页面的时候进行数据拉取，但是当配置发生变化时，直接使用上次请求得到的数据。那么，有没有一种较为优雅的解决方案？有的，那就是&lt;a href=&quot;http://developer.android.com/guide/components/loaders.html&quot;&gt;Loaders&lt;/a&gt;。
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android添加Java依赖库遇到的一个问题</title>
    <link href="http://yoursite.com/2015/11/18/android-support-max-jdk-version/"/>
    <id>http://yoursite.com/2015/11/18/android-support-max-jdk-version/</id>
    <published>2015-11-18T09:02:07.000Z</published>
    <updated>2016-03-05T05:47:11.171Z</updated>
    
    <content type="html">&lt;p&gt;最近尝试在Android中引入MVP架构，其中Model作为一个独立的Android Studio模块，是以Java工程的形式存在的。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;单独编译运行这个工程并没有问题，但最后在app中引入时却一直报如下错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;UNEXPECTED TOP-LEVEL EXCEPTION:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;java.lang.RuntimeException: Exception parsing classes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.processClass(Main.java:752)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.processFileBytes(Main.java:718)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.access$1200(Main.java:85)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main$FileBytesConsumer.processFileBytes(Main.java:1645)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.cf.direct.ClassPathOpener.processArchive(ClassPathOpener.java:284)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.cf.direct.ClassPathOpener.processOne(ClassPathOpener.java:166)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.cf.direct.ClassPathOpener.process(ClassPathOpener.java:144)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.processOne(Main.java:672)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.processAllFiles(Main.java:574)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.runMonoDex(Main.java:311)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.run(Main.java:277)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.main(Main.java:245)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.Main.main(Main.java:106)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Caused by: com.android.dx.cf.iface.ParseException: bad class file magic (cafebabe) or version (0034.0000)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.cf.direct.DirectClassFile.parse0(DirectClassFile.java:472)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.cf.direct.DirectClassFile.parse(DirectClassFile.java:406)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.cf.direct.DirectClassFile.parseToInterfacesIfNecessary(DirectClassFile.java:388)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.cf.direct.DirectClassFile.getMagic(DirectClassFile.java:251)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.parseClass(Main.java:764)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.access$1500(Main.java:85)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main$ClassParserTask.call(Main.java:1684)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at com.android.dx.command.dexer.Main.processClass(Main.java:749)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	... 12 more&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1 error; aborting&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Error:Execution failed for task &amp;apos;:app:preDexDebug&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; com.android.ide.common.process.ProcessException: org.gradle.process.internal.ExecException: Process &amp;apos;command &amp;apos;/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home/bin/java&amp;apos;&amp;apos; finished with non-zero exit value 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;关键信息在&lt;code&gt;java.lang.RuntimeException: Exception parsing classes&lt;/code&gt;和&lt;code&gt;/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/&lt;/code&gt;。可以发现，在类解析的过程中出错了，由于单独运行模块正常，初步判定是JDK版本问题。在&lt;code&gt;build.gradle&lt;/code&gt;中显式指定JDK版本为1.7:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apply plugin: &amp;apos;java&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sourceCompatibility = 1.7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;targetCompatibility = 1.7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile fileTree(dir: &amp;apos;libs&amp;apos;, include: [&amp;apos;*.jar&amp;apos;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.squareup.retrofit:retrofit:2.0.0-beta2&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.squareup.retrofit:converter-gson:2.0.0-beta2&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在SO找到了&lt;a href=&quot;http://stackoverflow.com/questions/30421389/android-studio-lambda-does-not-work&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;相应解答&lt;/a&gt;，之前一直没有注意，原来Android SDK支持的JDK最大版本只有到1.7。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近尝试在Android中引入MVP架构，其中Model作为一个独立的Android Studio模块，是以Java工程的形式存在的。
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android编码规范（非官方），持续更新中</title>
    <link href="http://yoursite.com/2015/11/16/android-coding-standard/"/>
    <id>http://yoursite.com/2015/11/16/android-coding-standard/</id>
    <published>2015-11-16T03:30:52.000Z</published>
    <updated>2016-03-05T05:47:11.170Z</updated>
    
    <content type="html">&lt;p&gt;这里只是个人习惯的归档，并不是官方规范。包括两大部分：Java代码规范和资源文件命名规范。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Java-Part&quot;&gt;&lt;a href=&quot;#Java-Part&quot; class=&quot;headerlink&quot; title=&quot;Java Part&quot;&gt;&lt;/a&gt;Java Part&lt;/h2&gt;&lt;h3 id=&quot;类成员变量&quot;&gt;&lt;a href=&quot;#类成员变量&quot; class=&quot;headerlink&quot; title=&quot;类成员变量&quot;&gt;&lt;/a&gt;类成员变量&lt;/h3&gt;&lt;p&gt;统一以’m’作为前缀来命名类成员变量。当然有唯一例外，那就是POJO或者JavaBean。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class MainActivity extends AppCompatActivity &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private static final String TAG = MainActivity.class.getSimpleName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private ProgressBarCircularIndeterminate mProgressBar;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private RecyclerView mRecyclerView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    protected void onCreate(Bundle savedInstanceState) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.activity_main);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        toolbar.setTitle(R.string.title_main);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setSupportActionBar(toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mProgressBar = (ProgressBarCircularIndeterminate) findViewById(R.id.pb_main);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mRecyclerView = (RecyclerView) findViewById(R.id.rv_movies);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mRecyclerView.setHasFixedSize(true);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mRecyclerView.setLayoutManager(new LinearLayoutManager(this));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fab.setOnClickListener(new View.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            public void onClick(View view) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                mProgressBar.setVisibility(View.VISIBLE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Movie.doSearch(MainActivity.this, new Movie.SearchListener&amp;lt;Hot&amp;gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    public void onResponse(Hot data) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        mProgressBar.setVisibility(View.GONE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        List&amp;lt;Movie&amp;gt; subjects = data.getSubjects();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        StringBuilder sb = new StringBuilder();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        for (Movie item : subjects) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            sb.append(item.getTitle()).append(&amp;quot;\n&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        LogUtil.d(TAG, sb.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public boolean onCreateOptionsMenu(Menu menu) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // Inflate the menu; this adds items to the action bar if it is present.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        getMenuInflater().inflate(R.menu.menu_main, menu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public boolean onOptionsItemSelected(MenuItem item) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // Handle action bar item clicks here. The action bar will&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // automatically handle clicks on the Home/Up button, so long&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // as you specify a parent activity in AndroidManifest.xml.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        int id = item.getItemId();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //noinspection SimplifiableIfStatement&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (id == R.id.action_settings) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return super.onOptionsItemSelected(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public class Rating &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        private float max;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        private float min;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        private float average;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        private String stars;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public float getMax() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return max;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public void setMax(float max) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            this.max = max;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public float getMin() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return min;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public void setMin(float min) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            this.min = min;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public float getAverage() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return average;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public void setAverage(float average) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            this.average = average;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public String getStars() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return stars;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public void setStars(String stars) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            this.stars = stars;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;成员变量初始化&quot;&gt;&lt;a href=&quot;#成员变量初始化&quot; class=&quot;headerlink&quot; title=&quot;成员变量初始化&quot;&gt;&lt;/a&gt;成员变量初始化&lt;/h3&gt;&lt;p&gt;若成员变量以’m’前缀，则成员变量初始化不带’this’关键字；若类作为POJO或者JavaBean形式，则仍然以’this’关键字的形式初始化。&lt;/p&gt;
&lt;h2 id=&quot;Res-Part&quot;&gt;&lt;a href=&quot;#Res-Part&quot; class=&quot;headerlink&quot; title=&quot;Res Part&quot;&gt;&lt;/a&gt;Res Part&lt;/h2&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;这里只是个人习惯的归档，并不是官方规范。包括两大部分：Java代码规范和资源文件命名规范。
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>记OSX环境安装RVM遇到的一个问题</title>
    <link href="http://yoursite.com/2015/11/12/problem-install-rvm/"/>
    <id>http://yoursite.com/2015/11/12/problem-install-rvm/</id>
    <published>2015-11-12T03:51:45.000Z</published>
    <updated>2016-03-05T05:47:11.169Z</updated>
    
    <content type="html">&lt;p&gt;之前都是在Windows平台搭建Octopress，这次在Mac上搭建，安装依赖项&lt;code&gt;Ruby 1.9.3&lt;/code&gt;遇到一个问题。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rvm install 1.9.3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;遇到一个问题，异常信息如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[2015-11-12 10:20:49] ./configure&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;current path: /Users/ruijie/.rvm/src/ruby-1.9.3-p551&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GEM_HOME=/Users/ruijie/.rvm/gems/ruby-2.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PATH=/usr/local/opt/pkg-config/bin:/usr/local/opt/libtool/bin:/usr/local/opt/automake/bin:/usr/local/opt/autoconf/bin:/Users/ruijie/.rvm/gems/ruby-2.2.1/bin:/Users/ruijie/.rvm/gems/ruby-2.2.1@global/bin:/Users/ruijie/.rvm/rubies/ruby-2.2.1/bin:/Users/ruijie/Code/gitCode/pylearn2/pylearn2/scripts:/Users/ruijie/data/pylearn2/data:/opt/local/bin:/opt/local/sbin:/Users/ruijie/Documents/adt-bundle-mac-x86_64-20140702/sdk/platform-tools:/usr/local/Cellar/python/2.7.10_2/Frameworks/Python.framework/Versions/2.7/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:/Users/ruijie/.rvm/bin:/Users/ruijie/.rvm/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GEM_PATH=/Users/ruijie/.rvm/gems/ruby-2.2.1:/Users/ruijie/.rvm/gems/ruby-2.2.1@global&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;command(7): ./configure --prefix=/Users/ruijie/.rvm/rubies/ruby-1.9.3-p551 --with-opt-dir=/usr/local/opt/libyaml:/usr/local/opt/readline:/usr/local/opt/libksba:/usr/local/opt/openssl --without-tcl --without-tk --disable-install-doc --enable-shared&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: WARNING: unrecognized options: --without-tcl, --without-tk&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checking build system type... x86_64-apple-darwin14.5.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checking host system type... x86_64-apple-darwin14.5.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checking target system type... x86_64-apple-darwin14.5.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checking whether the C compiler works... yes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checking for C compiler default output file name... a.out&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checking for suffix of executables... &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checking whether we are cross compiling... configure: error: in `/Users/ruijie/.rvm/src/ruby-1.9.3-p551&amp;apos;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure: error: cannot run C compiled programs.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;If you meant to cross compile, use `--host&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;See `config.log&amp;apos; for more details&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;通过关键信息&lt;code&gt;configure: error: cannot run C compiled programs.&lt;/code&gt;可以看出，很可能是由于编译器导致的。谷歌搜索下，在&lt;a href=&quot;http://stackoverflow.com/questions/8032824/cant-install-ruby-under-lion-with-rvm-gcc-issues&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Can’t install Ruby under Lion with RVM – GCC issues&lt;/a&gt;找到了答案。解决办法也很简单，手动指定编译器即可。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rvm install 1.9.3 --with-gcc=clang&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;之前都是在Windows平台搭建Octopress，这次在Mac上搭建，安装依赖项&lt;code&gt;Ruby 1.9.3&lt;/code&gt;遇到一个问题。
    
    </summary>
    
    
      <category term="Octopress" scheme="http://yoursite.com/tags/Octopress/"/>
    
  </entry>
  
  <entry>
    <title>Android JNI开发笔记</title>
    <link href="http://yoursite.com/2015/11/12/jni-notes/"/>
    <id>http://yoursite.com/2015/11/12/jni-notes/</id>
    <published>2015-11-12T02:51:45.000Z</published>
    <updated>2016-03-05T05:47:11.169Z</updated>
    
    <content type="html">&lt;p&gt;最近开发App涉及到许多图像处理操作，使用的OpenCV开源库，考虑到性能问题，决定使用JNI层开发。之前一直停留在应用层，并没有JNI层开发的经验，心里总感觉没谱，趁这次机会好好理理，权当纪录。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;工具&quot;&gt;&lt;a href=&quot;#工具&quot; class=&quot;headerlink&quot; title=&quot;工具&quot;&gt;&lt;/a&gt;工具&lt;/h2&gt;&lt;p&gt;工欲善其事，必先利其器。开发Android的话，首推&lt;a href=&quot;http://developer.android.com/sdk/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio&lt;/a&gt;，强大的智能提示和优秀的Gradle构建系统，能最大程度提高你的生产力；另外，既然涉及到JNI层开发，还需要下载&lt;a href=&quot;http://developer.android.com/ndk/downloads/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NDK工具集&lt;/a&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在早期版本，NDK和SDK是分别打包的；最新Android Studio 1.5，NDK和SDK捆绑，可以直接在Android Studio内安装。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;JNI开发概览&quot;&gt;&lt;a href=&quot;#JNI开发概览&quot; class=&quot;headerlink&quot; title=&quot;JNI开发概览&quot;&gt;&lt;/a&gt;JNI开发概览&lt;/h2&gt;&lt;h3 id=&quot;开发方式&quot;&gt;&lt;a href=&quot;#开发方式&quot; class=&quot;headerlink&quot; title=&quot;开发方式&quot;&gt;&lt;/a&gt;开发方式&lt;/h3&gt;&lt;p&gt;最开始Android Studio并不支持JNI开发，当时开发者只能选择Eclipse。传统的JNI开发是写好C/C++，最后通过编写Makefile编译脚本，生成so文件供应用层调用。&lt;br&gt;自从Android Studio 1.3版本加入JNI开发支持后，可以结合Gradle插件进行JNI开发，具体的编译任务通过Gradle插件完成，不需要额外编写编译脚本，并且&lt;strong&gt;支持JNI层调试&lt;/strong&gt;。&lt;br&gt;这里，我们通过后一种方式进行说明。具体的官方示例代码可以移步&lt;a href=&quot;https://github.com/googlesamples/android-ndk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&quot;具体步骤&quot;&gt;&lt;a href=&quot;#具体步骤&quot; class=&quot;headerlink&quot; title=&quot;具体步骤&quot;&gt;&lt;/a&gt;具体步骤&lt;/h3&gt;&lt;h4 id=&quot;新建Android工程&quot;&gt;&lt;a href=&quot;#新建Android工程&quot; class=&quot;headerlink&quot; title=&quot;新建Android工程&quot;&gt;&lt;/a&gt;新建Android工程&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-10 下午5.18.05.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;全部选择默认设置，一路Next。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-10 下午5.18.37.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-10 下午5.18.46.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-10 下午5.18.55.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;修改Gradle相关配置&quot;&gt;&lt;a href=&quot;#修改Gradle相关配置&quot; class=&quot;headerlink&quot; title=&quot;修改Gradle相关配置&quot;&gt;&lt;/a&gt;修改Gradle相关配置&lt;/h4&gt;&lt;p&gt;Andriod Studio新建工程的Gradle配置是不支持JNI开发的，需要我们手动进行调整。&lt;br&gt;找到&lt;code&gt;./gradle/wrapper/gradle-wrapper.properties&lt;/code&gt;，修改Gradle版本为2.5。目前，只有2.5版本支持JNI模块开发，可以参考&lt;a href=&quot;http://tools.android.com/tech-docs/new-build-system/gradle-experimental&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Experimental Plugin User Guide&lt;/a&gt;。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#Wed Oct 21 11:34:03 PDT 2015&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;distributionBase=GRADLE_USER_HOME&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;distributionPath=wrapper/dists&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;zipStoreBase=GRADLE_USER_HOME&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;zipStorePath=wrapper/dists&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;distributionUrl=https\://services.gradle.org/distributions/gradle-2.5-all.zip&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改&lt;code&gt;./build.gradle&lt;/code&gt;文件，将依赖模块修改为&lt;code&gt;gradle-experimental&lt;/code&gt;。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        classpath &amp;apos;com.android.tools.build:gradle-experimental:0.2.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改&lt;code&gt;./app/build.gradle&lt;/code&gt;文件，引入&lt;strong&gt;model&lt;/strong&gt;和&lt;strong&gt;JNI&lt;/strong&gt;配置。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apply plugin: &amp;apos;com.android.model.application&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;model &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    android &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        compileSdkVersion 23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        buildToolsVersion = &amp;quot;23.0.2&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        defaultConfig.with &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            applicationId = &amp;quot;com.aaron.nativeapp&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            minSdkVersion.apiLevel = 11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            targetSdkVersion.apiLevel = 23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compileOptions.with &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sourceCompatibility=JavaVersion.VERSION_1_7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        targetCompatibility=JavaVersion.VERSION_1_7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * native build settings&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    android.ndk &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        moduleName = &amp;quot;native&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        /*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * Other ndk flags configurable here are&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * cppFlags += &amp;quot;-fno-rtti&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * cppFlags += &amp;quot;-fno-exceptions&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * ldLibs    = [&amp;quot;android&amp;quot;, &amp;quot;log&amp;quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         * stl       = &amp;quot;system&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    android.buildTypes &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        release &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            minifyEnabled = false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            proguardFiles  += file(&amp;apos;proguard-rules.txt&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    android.productFlavors &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // for detailed abiFilter descriptions, refer to &amp;quot;Supported ABIs&amp;quot; @&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // https://developer.android.com/ndk/guides/abis.html#sa&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;arm&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ndk.abiFilters += &amp;quot;armeabi&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;arm7&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ndk.abiFilters += &amp;quot;armeabi-v7a&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;arm8&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ndk.abiFilters += &amp;quot;arm64-v8a&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;x86&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ndk.abiFilters += &amp;quot;x86&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;x86-64&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ndk.abiFilters += &amp;quot;x86_64&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;mips&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ndk.abiFilters += &amp;quot;mips&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;mips-64&amp;quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ndk.abiFilters += &amp;quot;mips64&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // To include all cpu architectures, leaves abiFilters empty&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        create(&amp;quot;all&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile fileTree(dir: &amp;apos;libs&amp;apos;, include: [&amp;apos;*.jar&amp;apos;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//    testCompile &amp;apos;junit:junit:4.12&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.android.support:appcompat-v7:23.1.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.android.support:design:23.1.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个有几个坑列一下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Gradle版本不对&lt;br&gt;解决办法：重新设置Gradle的安装目录。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-10 下午5.44.09.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;提示&lt;code&gt;Gradle DSL method not found: &amp;#39;testCompile()&amp;#39;&lt;/code&gt;&lt;br&gt;解决办法：注释测试模块。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;抛出&lt;code&gt;Error:Cause: org.gradle.api.internal.ExtensibleDynamicObject&lt;/code&gt;异常&lt;br&gt;一般是由于&lt;code&gt;＝&lt;/code&gt;操作符引起的，检查下脚本内容，确保赋值操作符都是&lt;code&gt;＝&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;应用层（Java层）&quot;&gt;&lt;a href=&quot;#应用层（Java层）&quot; class=&quot;headerlink&quot; title=&quot;应用层（Java层）&quot;&gt;&lt;/a&gt;应用层（Java层）&lt;/h4&gt;&lt;p&gt;新建一个包含native方法的class。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;package com.aaron.nativeapp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Created by Aaron on 15/11/11.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public class NativeCore &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public static native String nativeEcho(String param);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;nativeEcho(String param)&lt;/code&gt;方法很简单，就是在输入参数的基础上加上Echo字符串作为结尾。例如：&lt;strong&gt;Hi，JNI —&amp;gt; Hi，JNI Echo&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;创建好class后，&lt;code&gt;Rebuild Project&lt;/code&gt;将会在&lt;code&gt;./app/build/intermediates/classes/all/debug/com/aaron/nativeapp&lt;/code&gt;目录生成相应的&lt;code&gt;.class&lt;/code&gt;文件。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-11 上午10.16.23.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;JNI层&quot;&gt;&lt;a href=&quot;#JNI层&quot; class=&quot;headerlink&quot; title=&quot;JNI层&quot;&gt;&lt;/a&gt;JNI层&lt;/h4&gt;&lt;p&gt;打开Terminal，在&lt;code&gt;./app/build/intermediates/classes/all/debug&lt;/code&gt;目录执行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ javah -jni com.aaron.nativeapp.NativeCore&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;生成class对应的头文件&lt;code&gt;com_aaron_nativeapp_NativeCore.h&lt;/code&gt;。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/* DO NOT EDIT THIS FILE - it is machine generated */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;jni.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/* Header for class com_aaron_nativeapp_NativeCore */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifndef _Included_com_aaron_nativeapp_NativeCore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#define _Included_com_aaron_nativeapp_NativeCore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifdef __cplusplus&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;extern &amp;quot;C&amp;quot; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Class:     com_aaron_nativeapp_NativeCore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Method:    nativeEcho&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Signature: (Ljava/lang/String;)Ljava/lang/String;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JNIEXPORT jstring JNICALL Java_com_aaron_nativeapp_NativeCore_nativeEcho&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  (JNIEnv *, jclass, jstring);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifdef __cplusplus&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在&lt;code&gt;.app/src/main&lt;/code&gt;新建一个目录&lt;code&gt;jni&lt;/code&gt;，将头文件剪切到该目录下。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-11 上午10.25.59.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;现在可以开始着手写C代码了。代码内容很简单，读取从应用层传来的字符串，并在结尾处添加&lt;code&gt;Echo&lt;/code&gt;。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// Created by username on 15/11/11.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#include &amp;quot;com_aaron_nativeapp_NativeCore.h&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Class:     com_aaron_nativeapp_NativeCore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Method:    nativeEcho&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Signature: (Ljava/lang/String;)Ljava/lang/String;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;JNIEXPORT jstring JNICALL Java_com_aaron_nativeapp_NativeCore_nativeEcho&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        (JNIEnv *env, jclass thiz, jstring jParam) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    const char *c_param = env-&amp;gt;GetStringUTFChars(jParam, JNI_FALSE);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    char result[100];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    strcpy(result, c_param);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    strcat(result, &amp;quot; Echo&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    env-&amp;gt;ReleaseStringUTFChars(jParam, c_param);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return env-&amp;gt;NewStringUTF(result);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;加载静态库&quot;&gt;&lt;a href=&quot;#加载静态库&quot; class=&quot;headerlink&quot; title=&quot;加载静态库&quot;&gt;&lt;/a&gt;加载静态库&lt;/h4&gt;&lt;p&gt;最后一步，在NativeCore中添加静态代码段，加在本地库。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;package com.aaron.nativeapp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Created by Aaron on 15/11/11.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public class NativeCore &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    static &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.loadLibrary(&amp;quot;native&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public static native String nativeEcho(String param);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里静态库的名称就是在&lt;code&gt;./app/build.gradle&lt;/code&gt;中&lt;code&gt;android.ndk&lt;/code&gt;定义的&lt;code&gt;moduleName&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&quot;调用&quot;&gt;&lt;a href=&quot;#调用&quot; class=&quot;headerlink&quot; title=&quot;调用&quot;&gt;&lt;/a&gt;调用&lt;/h3&gt;&lt;p&gt;现在，所有的准备工作都完成了，让我们来调用&lt;code&gt;NativeCore&lt;/code&gt;看看结果。修改&lt;code&gt;MainActivity&lt;/code&gt;代码：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;package com.aaron.nativeapp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.os.Bundle;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.support.design.widget.FloatingActionButton;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.support.design.widget.Snackbar;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.support.v7.app.AppCompatActivity;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.support.v7.widget.Toolbar;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.view.View;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.view.Menu;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.view.MenuItem;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import android.widget.TextView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public class MainActivity extends AppCompatActivity &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TextView mTextView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    protected void onCreate(Bundle savedInstanceState) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.activity_main);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setSupportActionBar(toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mTextView = (TextView) findViewById(R.id.tv_content);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fab.setOnClickListener(new View.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            public void onClick(View view) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Snackbar.make(view, &amp;quot;Replace with your own action&amp;quot;, Snackbar.LENGTH_LONG)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .setAction(&amp;quot;Action&amp;quot;, null).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                mTextView.setText(NativeCore.nativeEcho(&amp;quot;Hi, JNI&amp;quot;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public boolean onCreateOptionsMenu(Menu menu) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // Inflate the menu; this adds items to the action bar if it is present.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        getMenuInflater().inflate(R.menu.menu_main, menu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public boolean onOptionsItemSelected(MenuItem item) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // Handle action bar item clicks here. The action bar will&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // automatically handle clicks on the Home/Up button, so long&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // as you specify a parent activity in AndroidManifest.xml.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        int id = item.getItemId();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        //noinspection SimplifiableIfStatement&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if (id == R.id.action_settings) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return super.onOptionsItemSelected(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;编译运行。点击右下角Fab按钮，显示JNI返回结果。&lt;/p&gt;
&lt;h3 id=&quot;JNI调试&quot;&gt;&lt;a href=&quot;#JNI调试&quot; class=&quot;headerlink&quot; title=&quot;JNI调试&quot;&gt;&lt;/a&gt;JNI调试&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;相对传统编写&lt;code&gt;.mk&lt;/code&gt;进行JNI开发的方式，使用&lt;code&gt;gradle-experimental&lt;/code&gt;插件开发的另一个好处就是支持JNI调试，选择运行选项为&lt;code&gt;app-native&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2015/11/屏幕快照 2015-11-11 上午11.36.06.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;在JNI层中打断点，点击&lt;code&gt;Debug&lt;/code&gt;就可以进行调试了。附一张效果图，还是挺方便的。&lt;/p&gt;
&lt;p&gt;可能会出现&lt;code&gt;unable to attach&lt;/code&gt;错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;DEVICE SHELL COMMAND: cat /data/local/tmp/start_lldb_server.sh | run-as com.aaron.nativeapp sh -c &amp;apos;cat &amp;gt; /data/data/com.aaron.nativeapp/lldb/bin/start_lldb_server.sh; chmod 700 /data/data/com.aaron.nativeapp/lldb/bin/start_lldb_server.sh&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Starting LLDB server: run-as com.aaron.nativeapp /data/data/com.aaron.nativeapp/lldb/bin/start_lldb_server.sh /data/data/com.aaron.nativeapp/lldb /data/data/com.aaron.nativeapp/lldb/tmp/platform-1447213097528.sock &amp;quot;lldb process:gdb-remote packets&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Now Launching Native Debug Session&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Failed to attach native debugger: unable to attach&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;unable to attach&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;多试几次就好了，小米1S亲测可用。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近开发App涉及到许多图像处理操作，使用的OpenCV开源库，考虑到性能问题，决定使用JNI层开发。之前一直停留在应用层，并没有JNI层开发的经验，心里总感觉没谱，趁这次机会好好理理，权当纪录。
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>如何在Android Service中开启对话框</title>
    <link href="http://yoursite.com/2015/05/13/launch-a-dialog-in-android-service/"/>
    <id>http://yoursite.com/2015/05/13/launch-a-dialog-in-android-service/</id>
    <published>2015-05-13T01:45:11.000Z</published>
    <updated>2016-03-05T05:47:11.168Z</updated>
    
    <content type="html">&lt;p&gt;最近碰到一个需求，需要在其他应用前台运行时弹出自己应用的对话框，通知用户信息。当然，这么做是完全和Android设计模式相悖的。通常情况下，当应用处于后台时，要以通知栏的形式和用户交互。但是，具体要如何实现了？让我们一起试试。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;直接使用AlertDialog并显示&quot;&gt;&lt;a href=&quot;#直接使用AlertDialog并显示&quot; class=&quot;headerlink&quot; title=&quot;直接使用AlertDialog并显示&quot;&gt;&lt;/a&gt;直接使用AlertDialog并显示&lt;/h2&gt;&lt;p&gt;最初的想法很简单，我在Service中直接&lt;code&gt;create&lt;/code&gt;一个对话框，然后调用&lt;code&gt;show&lt;/code&gt;方法不就行了吗？代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RunningService&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Service&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; IBinder &lt;span class=&quot;title&quot;&gt;onBind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Intent intent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStartCommand&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Intent intent, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; flags, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; startId)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        showDialog();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Handler().postDelayed(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                showDialog();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; START_STICKY;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;showDialog&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        AlertDialog dialog = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AlertDialog.Builder(App.getContext()).setTitle(R.string.prompt)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setMessage(getString(R.string.remove_ads_push_dialog_text))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setCancelable(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setPositiveButton(getString(R.string.confirm), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DialogInterface.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DialogInterface dialog, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .create();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dialog.show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;为了方便测试，我们让对话框弹出时间延迟5s。&lt;br&gt;在AndroidManifest注册该Service：&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;.aaron.service.RunningService&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;service&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;并在应用入口开启Service：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;startService(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, RunningService.class));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但是发现，应用在切回桌面后，并没有弹出对话框，而且Service也关闭了。其实是因为程序抛出了异常。上网找相关资料，原来只有依附于Activity或Fragment才能开启对话框，否则将抛出异常。那是不是意味着没办法在Service启动对话框呢？实际上并不是，我们需要额外做一个设置即可。&lt;/p&gt;
&lt;h2 id=&quot;Dialog设置成TYPE-SYSTEM-ALERT&quot;&gt;&lt;a href=&quot;#Dialog设置成TYPE-SYSTEM-ALERT&quot; class=&quot;headerlink&quot; title=&quot;Dialog设置成TYPE_SYSTEM_ALERT&quot;&gt;&lt;/a&gt;Dialog设置成TYPE_SYSTEM_ALERT&lt;/h2&gt;&lt;p&gt;将Dialog Type设置成&lt;code&gt;TYPE_SYSTEM_ALERT&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;showDialog&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AlertDialog dialog = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; AlertDialog.Builder(App.getContext()).setTitle(R.string.prompt)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setMessage(getString(R.string.remove_ads_push_dialog_text))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setCancelable(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .setPositiveButton(getString(R.string.confirm), &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DialogInterface.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(DialogInterface dialog, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; id)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            .create();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dialog.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dialog.show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;关键代码&lt;code&gt;dialog.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);&lt;/code&gt;&lt;br&gt;并在AndroidManifest中添加权限：&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;uses-permission&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;启动应用后，发现这次不会跑异常了，但返回桌面后，还是没见到弹出对话框。是程序出错了吗？如果在&lt;code&gt;dialog.show();&lt;/code&gt;之后打印&lt;strong&gt;Log&lt;/strong&gt;，是能正常打印的，说明对话框确实已经显示。如果此时返回我们的应用，会发现刚才没显示的对话框显示了。可以知道，虽然这种方案可以显示出对话框，但并不是我们想要的效果。我们需要在其他应用中显示对话框，而不需要回到自己的应用。&lt;/p&gt;
&lt;h2 id=&quot;使用对话框主题Activity&quot;&gt;&lt;a href=&quot;#使用对话框主题Activity&quot; class=&quot;headerlink&quot; title=&quot;使用对话框主题Activity&quot;&gt;&lt;/a&gt;使用对话框主题Activity&lt;/h2&gt;&lt;p&gt;我们知道，在Service中开启一个Activity是没有问题的，为何不用Activity作为我们的对话框呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;定义Activity Dialog样式&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;AppTheme.Dialg&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;parent&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;Theme.AppCompat.Light.Dialog&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;undefined&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;在Service中启动对话框Activity&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Handler().postDelayed(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Runnable() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		Intent dialogIntent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(SendActivePackageService.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, PushDialogActivity.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		dialogIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		startActivity(dialogIntent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;, Config.DELAY_SHOW_PUSH_DIALOG);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;需要注意&lt;code&gt;setFlags(Intent.FLAG_ACTIVITY_NEW_TASK)&lt;/code&gt;不能少，否则开启对话框时会强制跳转到对话框所属的应用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;举个简单的例子，比如现在正使用优酷客户端。这时，后台服务弹出对话框了，该对话框并不是直接覆盖在优酷客户端上，而是先跳转到你的应用，再弹出对话框。这显然不是我们想要的，大家可以试试。&lt;/p&gt;
&lt;p&gt;目前，最后一种解决方案真正解决了我们的需求。但还是重复一遍，因为非常重要：&lt;br&gt;&lt;strong&gt;切忌在其他应用中弹出自己应用的对话框，类似的场景应该采用Notification来解决。&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;http://stackoverflow.com/questions/7918571/how-to-display-a-dialog-from-a-service&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;How to display a Dialog from a Service&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近碰到一个需求，需要在其他应用前台运行时弹出自己应用的对话框，通知用户信息。当然，这么做是完全和Android设计模式相悖的。通常情况下，当应用处于后台时，要以通知栏的形式和用户交互。但是，具体要如何实现了？让我们一起试试。
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>在新机器上部署已有Octopress博客</title>
    <link href="http://yoursite.com/2015/05/11/setup-octopress-on-new-computer-enviroment/"/>
    <id>http://yoursite.com/2015/05/11/setup-octopress-on-new-computer-enviroment/</id>
    <published>2015-05-11T02:41:21.000Z</published>
    <updated>2016-03-05T05:47:11.167Z</updated>
    
    <content type="html">&lt;p&gt;通过&lt;a href=&quot;http://aaronchansunny.github.io/blog/2014/11/12/install-octopress/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github搭建Octopress博客&lt;/a&gt;，我们可以搭建Octopress。但是如果我们需要在一台新机器上部署Github上已有的Octopress，需要怎么做呢？步骤上大体一致。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;克隆Github代码&quot;&gt;&lt;a href=&quot;#克隆Github代码&quot; class=&quot;headerlink&quot; title=&quot;克隆Github代码&quot;&gt;&lt;/a&gt;克隆Github代码&lt;/h2&gt;&lt;p&gt;分别克隆Github下&lt;strong&gt;source&lt;/strong&gt;分支和&lt;strong&gt;master&lt;/strong&gt;分支到本地。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;克隆Source分支&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;$ git clone -b source git@github.com:username/username.github.com.git octopress
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;克隆Master分支&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;$ cd octopress 
$ git clone git@github.com:username/username.github.com.git _deploy
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;执行完这两步就OK了。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;注意这里第2步一定要，不然在rake deploy时会报错：&lt;br&gt;no such file or directory - _deploy&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;安装依赖项&quot;&gt;&lt;a href=&quot;#安装依赖项&quot; class=&quot;headerlink&quot; title=&quot;安装依赖项&quot;&gt;&lt;/a&gt;安装依赖项&lt;/h2&gt;&lt;p&gt;另外，如果是重新在一台全新的电脑上要和服务器上的进行同步，除了上面的操作之外，还需要安装：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ruby&lt;/li&gt;
&lt;li&gt;Devkit&lt;/li&gt;
&lt;li&gt;Python&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;这里需要注意安装Ruby和Devkit的版本：&lt;br&gt;rubyinstaller-1.9.3-p550&lt;br&gt;DevKit-tdm-32-4.5.2-20111229-1559-sfx&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;安装完成后，运行如下命令：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;ruby&quot;&gt;$ cd DevKit 
$ ruby dk.rb init 
$ ruby dk.rb install
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;安装Python语法高亮模块：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;$ cd Python34 
$ cd Scripts
$ easy_install pygments
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;进行Octopress依赖项安装：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ cd octopress
$ gem install bundler
$ bundle install
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;如果出现SSL授权错误，请参考：&lt;br&gt;&lt;a href=&quot;http://stackoverflow.com/questions/10246023/bundle-install-fails-with-ssl-certificate-verification-error&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;bundle install fails with SSL certificate verification error [duplicate]&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;到此，Octopress环境就配置完成了，又能嗨皮地写博客了～&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;通过&lt;a href=&quot;http://aaronchansunny.github.io/blog/2014/11/12/install-octopress/&quot;&gt;Github搭建Octopress博客&lt;/a&gt;，我们可以搭建Octopress。但是如果我们需要在一台新机器上部署Github上已有的Octopress，需要怎么做呢？步骤上大体一致。
    
    </summary>
    
    
      <category term="Octopress" scheme="http://yoursite.com/tags/Octopress/"/>
    
  </entry>
  
  <entry>
    <title>Windows下修改输入法切换快捷键</title>
    <link href="http://yoursite.com/2014/11/28/input-method-switch-key/"/>
    <id>http://yoursite.com/2014/11/28/input-method-switch-key/</id>
    <published>2014-11-28T01:34:41.000Z</published>
    <updated>2016-03-05T05:47:11.166Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;最近打算从Eclipse迁移到Android Studio（以下简称AS），这是Android开发的趋势。在AS中，代码自动补全的快捷键是&lt;code&gt;ctrl+space&lt;/code&gt;，和Windows系统下切换输入法的快捷键冲突。既然这样，就更改输入法快捷键吧。当然方法很多，最方便的方法是直接修改注册表文件。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;过程&quot;&gt;&lt;a href=&quot;#过程&quot; class=&quot;headerlink&quot; title=&quot;过程&quot;&gt;&lt;/a&gt;过程&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;运行&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/26.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;找到注册表项&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/27.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;更改&lt;br&gt;修改Key Modifiers如下：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/28.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;重启或注销&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      Windows下修改输入法切换快捷键
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Eclipse使用Maven搭建Spring+Struts2+Hibernate工程</title>
    <link href="http://yoursite.com/2014/11/21/setup-ssh2-web-project-by-maven/"/>
    <id>http://yoursite.com/2014/11/21/setup-ssh2-web-project-by-maven/</id>
    <published>2014-11-21T06:46:21.000Z</published>
    <updated>2016-03-05T05:47:11.166Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;为了熟悉Spring+Struts2+Hibernate工程（SSH2）各个框架的配置，一直想自己手动搭个SSH2。但每次一想到那么多jar包依赖，总提不起勇气，相信这也是很多刚学习JavaWeb的朋友所困扰的问题。对于Maven真是久仰大名，最近拜读了许晓斌前辈《Maven实战》这本书，真是有种相见恨晚的感觉。总之，Maven为我们建立了一套标准，并提供中央仓库让我们能在线获取第三方jar包资源，只要我们遵循这个标准，构建将变得如此轻松。使用Maven构建的最佳实践是使用命令行，但对于Java开发人员，Eclipse等IDE工具虽然在构建上具有先天不足，但在编码上确实能大大提高效率。幸运的是，Eclipse现在已经集成m2eclipse插件，提供Maven工程创建和管理。那就现学现卖吧~就让我们一起在Eclipse下用Maven搭建一个SSH2工程示例。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;安装Maven&quot;&gt;&lt;a href=&quot;#安装Maven&quot; class=&quot;headerlink&quot; title=&quot;安装Maven&quot;&gt;&lt;/a&gt;安装Maven&lt;/h2&gt;&lt;p&gt;安装Maven很简单，首先访问Maven官网，选择最新版本下载，安装过程一路&lt;code&gt;next&lt;/code&gt;即可。&lt;br&gt;安装结束后，添加Maven安装目录到系统路径PATH。&lt;br&gt;运行&lt;code&gt;sysdm.cpl&lt;/code&gt;打开系统属性：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/06.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;选择&lt;strong&gt;高级&lt;/strong&gt;选项卡：  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/07.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;PATH&lt;/code&gt;中添加Maven安装目录，例如：&lt;code&gt;E:\Program Files\maven-3.2.3\bin&lt;/code&gt;。&lt;br&gt;验证Maven是否安装成功：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;C:\Users\OA&amp;gt;mvn --version
Apache Maven 3.2.3 (33f8c3e1027c3ddde99d3cdebad2656a31e8fdf4; 2014-08-12T04:58:1
0+08:00)
Maven home: E:\Program Files\maven-3.2.3\bin\..
Java version: 1.8.0_05, vendor: Oracle Corporation
Java home: E:\Program Files\Java\jdk1.8.0_05\jre
Default locale: zh_CN, platform encoding: GBK
OS name: &amp;quot;windows 7&amp;quot;, version: &amp;quot;6.1&amp;quot;, arch: &amp;quot;x86&amp;quot;, family: &amp;quot;dos&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;创建Maven工程&quot;&gt;&lt;a href=&quot;#创建Maven工程&quot; class=&quot;headerlink&quot; title=&quot;创建Maven工程&quot;&gt;&lt;/a&gt;创建Maven工程&lt;/h2&gt;&lt;h3 id=&quot;Eclipse版本&quot;&gt;&lt;a href=&quot;#Eclipse版本&quot; class=&quot;headerlink&quot; title=&quot;Eclipse版本&quot;&gt;&lt;/a&gt;Eclipse版本&lt;/h3&gt;&lt;p&gt;如果Eclipse版本过低，可能还没有集成&lt;code&gt;m2eclipse&lt;/code&gt;插件，需要手动安装。例子中使用的Eclipse版本：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/08.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;具体步骤&quot;&gt;&lt;a href=&quot;#具体步骤&quot; class=&quot;headerlink&quot; title=&quot;具体步骤&quot;&gt;&lt;/a&gt;具体步骤&lt;/h3&gt;&lt;p&gt;Luna版Eclipse默认已经集成插件，可以直接创建Maven工程：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/09.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/10.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;直接Next，在Filter中输入web关键字，找到maven-archetype-webapp：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/11.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;继续Next，出现如下界面：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/12.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;依次输入Group Id和Artifact Id信息：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/13.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Package会自动补全，点击Finish。&lt;/p&gt;
&lt;h3 id=&quot;工程目录结构&quot;&gt;&lt;a href=&quot;#工程目录结构&quot; class=&quot;headerlink&quot; title=&quot;工程目录结构&quot;&gt;&lt;/a&gt;工程目录结构&lt;/h3&gt;&lt;p&gt;Eclipse创建好的Maven工程目录结构如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/14.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;额，怎么还有错误，而且目录结构和Maven约定的也不相同。没关系，让我们一步步解决他们。&lt;br&gt;使用Maven自动构建和管理项目有一个前提，目录结构需要和Maven规定的相一致。&lt;br&gt;通过Eclipse生成的Maven工程还差以下目录：&lt;br&gt;1.src/main/java&lt;br&gt;2.src/test/java&lt;br&gt;3.src/test/resources&lt;br&gt;这三个目录，需要我们手动添加，添加后Java Resources目录如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/15.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;右键工程Properties-&amp;gt;Java Build Path在Source选项卡配置Source folders输出目录：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/16.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;现在我们的工程目录就和Maven标准目录相一致了。&lt;/p&gt;
&lt;h3 id=&quot;错误解决&quot;&gt;&lt;a href=&quot;#错误解决&quot; class=&quot;headerlink&quot; title=&quot;错误解决&quot;&gt;&lt;/a&gt;错误解决&lt;/h3&gt;&lt;p&gt;接下来， 让我们看看工程报的错误：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/17.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;提示说找不到&lt;code&gt;javax.servlet.http.HttpServlet&lt;/code&gt;，也就说缺少Servlet API。按照传统的做法，我们会新建一个lib目录，然后网上找到Servlet API的jar包，还要配置工程属性，将依赖添加进来。而且，每次新增第三方库，都要重复上述步骤，这既无趣又耗时。在依赖库版本更新时，还要同时更新相应的依赖包，这时候特别容易出现版本冲突问题。但是如果有了Maven呢？一切变得如此简单，我们只需在POM中添加如下依赖信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;servlet-api&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.5&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接下来，把所有事情交给Maven吧。保存POM文件后，Maven会根据依赖信息，先到本地仓库加载依赖包，如果本地没有所需依赖包，再到Maven中央仓库下载。依赖包下载完成后，刚才的错误也就解决了。&lt;br&gt;Luna创建Maven工程默认使用JDK1.5，因此出现以下警告信息：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/18.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;右键工程Properties-&amp;gt;Java Compiler将Compiler compliance level更改为1.8：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/19.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这里需要根据实际安装的JDK版本进行修改，例子中安装的是JDK1.8。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;保存退出后，如下错误信息：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/20.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;右键工程Properties-&amp;gt;Project Facets，将Java版本更改为1.8：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/21.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;至此，使用Maven搭建JavaWeb工程全部完成。&lt;/p&gt;
&lt;h2 id=&quot;配置POM文件&quot;&gt;&lt;a href=&quot;#配置POM文件&quot; class=&quot;headerlink&quot; title=&quot;配置POM文件&quot;&gt;&lt;/a&gt;配置POM文件&lt;/h2&gt;&lt;p&gt;使用Maven管理SSH2所需要的依赖库，POM文件就是全部，具体可以查看&lt;a href=&quot;https://github.com/aaronchansunny/mavendemo/blob/master/pom.xml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pom.xml&lt;/a&gt;。修改POM文件后保存，m2eclipse插件就开始从Maven中央库下载依赖包，这个过程取决于你的网速，如果依赖包较多，需要的时间比较漫长。如果Maven本地仓库已经有这些依赖包了，Maven将直接加载本地包。那么，要如何找到我们需要的第三方库呢？一般的做法是直接谷歌，例如我们要找spring框架依赖，直接输入关键字&lt;strong&gt;maven repository spring&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/22.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;也可以直接访问：&lt;a href=&quot;http://mvnrepository.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://mvnrepository.com/&lt;/a&gt;进行搜索。&lt;/p&gt;
&lt;h2 id=&quot;SSH2配置文件&quot;&gt;&lt;a href=&quot;#SSH2配置文件&quot; class=&quot;headerlink&quot; title=&quot;SSH2配置文件&quot;&gt;&lt;/a&gt;SSH2配置文件&lt;/h2&gt;&lt;p&gt;到目前为止，Maven已经完成它的依赖包管理使命了，以后要是想新增或更新依赖包直接修改POM文件即可，相对传统管理依赖包的方式简直是一本万利。接下来，进行SSH2各模块的配置，示例程序中已经给出详细注释，这里只简单列出说明。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;web.xml&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;web-app xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xmlns=&amp;quot;http://java.sun.com/xml/ns/javaee&amp;quot; xmlns:web=&amp;quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xsi:schemaLocation=&amp;quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	id=&amp;quot;WebApp_ID&amp;quot; version=&amp;quot;3.0&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;display-name&amp;gt;ssh2_test&amp;lt;/display-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;welcome-file-list&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;welcome-file&amp;gt;index.jsp&amp;lt;/welcome-file&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/welcome-file-list&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;filter&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-name&amp;gt;CharsetEncodingFilter&amp;lt;/filter-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-class&amp;gt;com.fish.ssh2.filter.CharsetEncodingFilter&amp;lt;/filter-class&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;init-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;param-name&amp;gt;encoding&amp;lt;/param-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;param-value&amp;gt;GB18030&amp;lt;/param-value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/init-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/filter&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;filter-mapping&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-name&amp;gt;CharsetEncodingFilter&amp;lt;/filter-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/filter-mapping&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 配置spring资源 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;context-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;param-value&amp;gt;classpath:config/applicationContext-*.xml&amp;lt;/param-value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/context-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 配置CharacterEncoding，设置字符集 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- &amp;lt;filter&amp;gt; &amp;lt;filter-name&amp;gt;characterEncodingFilter&amp;lt;/filter-name&amp;gt; &amp;lt;filter-class&amp;gt;org.springframework.web.filter.CharacterEncodingFilter&amp;lt;/filter-class&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;init-param&amp;gt; &amp;lt;param-name&amp;gt;encoding&amp;lt;/param-name&amp;gt; &amp;lt;param-value&amp;gt;UTF-8&amp;lt;/param-value&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/init-param&amp;gt; &amp;lt;init-param&amp;gt; &amp;lt;param-name&amp;gt;forceEncoding&amp;lt;/param-name&amp;gt; &amp;lt;param-value&amp;gt;true&amp;lt;/param-value&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/init-param&amp;gt; &amp;lt;/filter&amp;gt; &amp;lt;filter-mapping&amp;gt; &amp;lt;filter-name&amp;gt;characterEncodingFilter&amp;lt;/filter-name&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt; &amp;lt;/filter-mapping&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 将HibernateSession开关控制配置在Filter，保证一个请求一个session，并对lazy提供支持 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;filter&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-name&amp;gt;OpenSessionInView&amp;lt;/filter-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-class&amp;gt;org.springframework.orm.hibernate4.support.OpenSessionInViewFilter&amp;lt;/filter-class&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;init-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;param-name&amp;gt;singleSession&amp;lt;/param-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;param-value&amp;gt;true&amp;lt;/param-value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/init-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/filter&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;filter-mapping&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-name&amp;gt;OpenSessionInView&amp;lt;/filter-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/filter-mapping&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 配置Struts2 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;filter&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-name&amp;gt;struts2&amp;lt;/filter-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-class&amp;gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter&amp;lt;/filter-class&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;init-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;param-name&amp;gt;config&amp;lt;/param-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;param-value&amp;gt;struts-default.xml,struts-plugin.xml,/config/struts.xml&amp;lt;/param-value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/init-param&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/filter&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;filter-mapping&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;filter-name&amp;gt;struts2&amp;lt;/filter-name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/filter-mapping&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 配置spring --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;listener&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;listener-class&amp;gt;org.springframework.web.context.ContextLoaderListener&amp;lt;/listener-class&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/listener&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/web-app&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;web.xml文件是Web容器加载Web应用的入口，主要包括应用全局变量、Spring监听器、Struts2核心控制器以及设置字符集等信息。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;applicationContext-beans.xml&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:aop=&amp;quot;http://www.springframework.org/schema/aop&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot; xmlns:tx=&amp;quot;http://www.springframework.org/schema/tx&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- Spring管理Struts2的Action --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean name=&amp;quot;loginAction&amp;quot; class=&amp;quot;com.fish.ssh2.action.LoginAction&amp;quot; scope=&amp;quot;prototype&amp;quot;&amp;gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean name=&amp;quot;userMainAction&amp;quot; class=&amp;quot;com.opensymphony.xwork2.ActionSupport&amp;quot; scope=&amp;quot;prototype&amp;quot;&amp;gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean name=&amp;quot;userAction&amp;quot; class=&amp;quot;com.fish.ssh2.action.UserAction&amp;quot; scope=&amp;quot;prototype&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- &amp;lt;property name=&amp;quot;userManage&amp;quot; ref=&amp;quot;userManage&amp;quot;&amp;gt;&amp;lt;/property&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- Spring管理Struts2的Interceptor --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean name=&amp;quot;checkLoginInterceptor&amp;quot; class=&amp;quot;com.fish.ssh2.interceptor.CheckLogin&amp;quot; scope=&amp;quot;prototype&amp;quot;&amp;gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean name=&amp;quot;userManage&amp;quot; class=&amp;quot;com.fish.ssh2.service.impl.UserManageImpl&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- &amp;lt;property name=&amp;quot;userDao&amp;quot; ref=&amp;quot;userDao&amp;quot;&amp;gt;&amp;lt;/property&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean name=&amp;quot;userDao&amp;quot; class=&amp;quot;com.fish.ssh2.dao.impl.UserDaoImpl&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;sessionFactory&amp;quot; ref=&amp;quot;sessionFactory&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/beans&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Spring在SSH2框架中就是最大的工厂，所有交给Spring托管的Bean和它们之间的依赖关系都要在applicationContext-beans.xml声明。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;applicationContext-common.xml&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;beans xmlns=&amp;quot;http://www.springframework.org/schema/beans&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:aop=&amp;quot;http://www.springframework.org/schema/aop&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xmlns:context=&amp;quot;http://www.springframework.org/schema/context&amp;quot; xmlns:tx=&amp;quot;http://www.springframework.org/schema/tx&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	xsi:schemaLocation=&amp;quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 启用spring注解支持 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;context:annotation-config /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!--配数据源 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean id=&amp;quot;dataSource&amp;quot; class=&amp;quot;org.apache.commons.dbcp.BasicDataSource&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		destroy-method=&amp;quot;close&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- 数据库连接驱动 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;driverClassName&amp;quot; value=&amp;quot;com.mysql.jdbc.Driver&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- 数据库url --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;url&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			value=&amp;quot;jdbc:mysql://localhost/db?characterEncoding=utf-8&amp;amp;amp;autoReconnect=true&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- 数据库用户名 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;root&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- 数据库密码 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;root&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean id=&amp;quot;sessionFactory&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		class=&amp;quot;org.springframework.orm.hibernate4.LocalSessionFactoryBean&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;dataSource&amp;quot; ref=&amp;quot;dataSource&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;hibernateProperties&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;props&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;!-- 指定数据库方言 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;prop key=&amp;quot;hibernate.dialect&amp;quot;&amp;gt;org.hibernate.dialect.MySQLDialect&amp;lt;/prop&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;!-- 是否显示Hibernate产生的SQL语句 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;prop key=&amp;quot;hibernate.show_sql&amp;quot;&amp;gt;true&amp;lt;/prop&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;!-- 启动应用时，是否根据HBM文件创建数据表 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;prop key=&amp;quot;hibernate.hbm2ddl.auto&amp;quot;&amp;gt;update&amp;lt;/prop&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/props&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- 如果使用配置文件 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- &amp;lt;property name=&amp;quot;mappingLocations&amp;quot;&amp;gt; &amp;lt;list&amp;gt; &amp;lt;value&amp;gt;classpath:com/jialin/entity/User.hbm.xml&amp;lt;/value&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/list&amp;gt; &amp;lt;/property&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;annotatedClasses&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;list&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;value&amp;gt;com.fish.ssh2.entity.User&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/list&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 配置事务管理器 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;bean id=&amp;quot;transactionManager&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		class=&amp;quot;org.springframework.orm.hibernate4.HibernateTransactionManager&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;property name=&amp;quot;sessionFactory&amp;quot; ref=&amp;quot;sessionFactory&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 事务的传播特性 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;tx:advice id=&amp;quot;txadvice&amp;quot; transaction-manager=&amp;quot;transactionManager&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;tx:attributes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;tx:method name=&amp;quot;*&amp;quot; propagation=&amp;quot;REQUIRED&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;!--hibernate4必须配置为开启事务 否则 getCurrentSession()获取不到 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;!-- &amp;lt;tx:method name=&amp;quot;*&amp;quot; propagation=&amp;quot;REQUIRED&amp;quot; read-only=&amp;quot;true&amp;quot; /&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/tx:attributes&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/tx:advice&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 那些类那些方法使用事务 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;aop:config&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- 只对业务逻辑层实施事务 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;aop:pointcut id=&amp;quot;allManagerMethod&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			expression=&amp;quot;execution(* com.fish.ssh2.service.impl.*.*(..))&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;aop:advisor pointcut-ref=&amp;quot;allManagerMethod&amp;quot; advice-ref=&amp;quot;txadvice&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/aop:config&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/beans&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Spring的基本配置文件，包括配置常量定义、数据源和事务管理等。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;struts.xml&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!DOCTYPE struts PUBLIC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;-//Apache Software Foundation//DTD Struts Configuration 2.0//EN&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;http://struts.apache.org/dtds/struts-2.0.dtd&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;struts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 将Action的创建交给spring来管理 --&amp;gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;constant name=&amp;quot;struts.objectFactory&amp;quot; value=&amp;quot;spring&amp;quot; /&amp;gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 更改struts2请求Action的后缀名，默认为action。若想去掉后缀，设为&amp;quot;,&amp;quot;即可 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;constant name=&amp;quot;struts.action.extension&amp;quot; value=&amp;quot;,&amp;quot;&amp;gt;&amp;lt;/constant&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 公共包 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!-- 	&amp;lt;package name=&amp;quot;abstract_struts&amp;quot; abstract=&amp;quot;true&amp;quot; extends=&amp;quot;struts-default&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		namespace=&amp;quot;/&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;interceptors&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;interceptor name=&amp;quot;checkLogin&amp;quot; class=&amp;quot;com.fish.ssh2.interceptor.CheckLogin&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;interceptor-stack name=&amp;quot;myInterceptor&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;checkLogin&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;defaultStack&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/interceptor-stack&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/interceptors&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;default-interceptor-ref name=&amp;quot;myInterceptor&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;global-results&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;result name=&amp;quot;checkLoginFail&amp;quot;&amp;gt;/login.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/global-results&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/package&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;package name=&amp;quot;abstract_struts&amp;quot; abstract=&amp;quot;true&amp;quot; extends=&amp;quot;struts-default&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		namespace=&amp;quot;/&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;interceptors&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;interceptor name=&amp;quot;checkLogin&amp;quot; class=&amp;quot;checkLoginInterceptor&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;interceptor-stack name=&amp;quot;myInterceptor&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;checkLogin&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;defaultStack&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/interceptor-stack&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/interceptors&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- &amp;lt;default-interceptor-ref name=&amp;quot;myInterceptor&amp;quot; /&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;global-results&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;result name=&amp;quot;checkLoginFail&amp;quot;&amp;gt;/login.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/global-results&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/package&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!-- 包含的配置文件 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;include file=&amp;quot;/config/struts-user.xml&amp;quot;&amp;gt;&amp;lt;/include&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/struts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Struts2核心配置文件。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;struts-user.xml&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; ?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;!DOCTYPE struts PUBLIC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;quot;-//Apache Software Foundation//DTD Struts Configuration 2.0//EN&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;quot;http://struts.apache.org/dtds/struts-2.0.dtd&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;struts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	    &amp;lt;!-- 未与spring集成的写法 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- &amp;lt;package name=&amp;quot;loginAction&amp;quot; namespace=&amp;quot;/&amp;quot; extends=&amp;quot;abstract_struts&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;action name=&amp;quot;login&amp;quot; class=&amp;quot;com.fish.ssh2.action.LoginAction&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;success&amp;quot; type=&amp;quot;redirect&amp;quot;&amp;gt;userMain&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;fail&amp;quot;&amp;gt;/fail.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			该action只负责跳转，用struts提供的ActionSupport&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;action name=&amp;quot;userMain&amp;quot; class=&amp;quot;com.opensymphony.xwork2.ActionSupport&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;success&amp;quot;&amp;gt;/userMain.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;myInterceptor&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/package&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;package name=&amp;quot;userActions&amp;quot; namespace=&amp;quot;/user&amp;quot; extends=&amp;quot;abstract_struts&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;action name=&amp;quot;*_*&amp;quot; class=&amp;quot;com.fish.ssh2.action.UserAction&amp;quot; method=&amp;quot;&amp;#123;1&amp;#125;&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;success&amp;quot; type=&amp;quot;redirect&amp;quot;&amp;gt;/&amp;#123;2&amp;#125;.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;fail&amp;quot;&amp;gt;/fail.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;myInterceptor&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/package&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;!-- 与spring集成的写法，action等交予spring管理 --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;package name=&amp;quot;loginAction&amp;quot; namespace=&amp;quot;/&amp;quot; extends=&amp;quot;abstract_struts&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;action name=&amp;quot;login&amp;quot; class=&amp;quot;loginAction&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;success&amp;quot; type=&amp;quot;redirect&amp;quot;&amp;gt;userMain&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;fail&amp;quot;&amp;gt;/fail.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;!-- 该action只负责跳转，用struts提供的ActionSupport --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;action name=&amp;quot;userMain&amp;quot; class=&amp;quot;userMainAction&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;success&amp;quot;&amp;gt;/userMain.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;myInterceptor&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/package&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;package name=&amp;quot;userActions&amp;quot; namespace=&amp;quot;/user&amp;quot; extends=&amp;quot;abstract_struts&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;action name=&amp;quot;*_*&amp;quot; class=&amp;quot;userAction&amp;quot; method=&amp;quot;&amp;#123;1&amp;#125;&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;success&amp;quot; type=&amp;quot;redirect&amp;quot;&amp;gt;/&amp;#123;2&amp;#125;.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;result name=&amp;quot;fail&amp;quot;&amp;gt;/fail.jsp&amp;lt;/result&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;lt;interceptor-ref name=&amp;quot;myInterceptor&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;lt;/action&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;lt;/package&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/struts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;该配置文件用来定义业务逻辑Actions。&lt;br&gt;可以发现，这里我们对Spring和Struts2的配置文件都进行拆分处理，这样做可以避免单个配置文件过于臃肿，也方便将来进行扩展。&lt;/p&gt;
&lt;h2 id=&quot;创建数据库&quot;&gt;&lt;a href=&quot;#创建数据库&quot; class=&quot;headerlink&quot; title=&quot;创建数据库&quot;&gt;&lt;/a&gt;创建数据库&lt;/h2&gt;&lt;p&gt;在之前的数据源配置中，我们连接了一个名叫db的数据库：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- 数据库url --&amp;gt;
&amp;lt;property name=&amp;quot;url&amp;quot;
    value=&amp;quot;jdbc:mysql://localhost/db?characterEncoding=utf-8&amp;amp;amp;autoReconnect=true&amp;quot; /&amp;gt;
&amp;lt;!-- 数据库用户名 --&amp;gt;
&amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;root&amp;quot; /&amp;gt;
&amp;lt;!-- 数据库密码 --&amp;gt;
&amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;root&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;因此，这里需要创建一个db数据库，并添加p_user表作为新增用户测试。&lt;br&gt;登录MySQL数据库：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;C:\Users\OA&amp;gt; mysql -uroot -proot
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;执行如下SQL脚本：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;CREATE DATABASE db;
USE db;
DROP TABLE IF EXISTS `p_user`;
CREATE TABLE `p_user` (
  `id` int(10) unsigned AUTO_INCREMENT NOT NULL,
  `name` varchar(45) DEFAULT NULL,
  `password` varchar(45) DEFAULT NULL,
  `age` int(11) DEFAULT 0,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;示例程序编写&quot;&gt;&lt;a href=&quot;#示例程序编写&quot; class=&quot;headerlink&quot; title=&quot;示例程序编写&quot;&gt;&lt;/a&gt;示例程序编写&lt;/h2&gt;&lt;p&gt;为了简单起见，这里以一个简单的登录和新增用户作为例子进行说明。MVC分层结构如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/23.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;示例源码托管在Github：&lt;a href=&quot;https://github.com/aaronchansunny/mavendemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/aaronchansunny/mavendemo&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;示例演示&quot;&gt;&lt;a href=&quot;#示例演示&quot; class=&quot;headerlink&quot; title=&quot;示例演示&quot;&gt;&lt;/a&gt;示例演示&lt;/h2&gt;&lt;h3 id=&quot;登录&quot;&gt;&lt;a href=&quot;#登录&quot; class=&quot;headerlink&quot; title=&quot;登录&quot;&gt;&lt;/a&gt;登录&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/images/2014/11/24.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;输入用户名：root；密码：root123。  &lt;/p&gt;
&lt;h3 id=&quot;新增用户&quot;&gt;&lt;a href=&quot;#新增用户&quot; class=&quot;headerlink&quot; title=&quot;新增用户&quot;&gt;&lt;/a&gt;新增用户&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/images/2014/11/25.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;新增新用户：test。  &lt;/p&gt;
&lt;h3 id=&quot;查看数据库&quot;&gt;&lt;a href=&quot;#查看数据库&quot; class=&quot;headerlink&quot; title=&quot;查看数据库&quot;&gt;&lt;/a&gt;查看数据库&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;mysql&amp;gt; use db;
mysql&amp;gt; select * from p_user;
+----+------+----------+------+
| id | name | password | age  |
+----+------+----------+------+
|  1 | test | 123      |   12 |
+----+------+----------+------+
1 row in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;刚才新增的用户，已经成功保存至数据库。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      Eclipse使用Maven搭建Spring+Struts2+Hibernate工程
    
    </summary>
    
    
      <category term="JavaWeb" scheme="http://yoursite.com/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>给Octopress每篇博客添加版权信息</title>
    <link href="http://yoursite.com/2014/11/20/add-blog-copyright/"/>
    <id>http://yoursite.com/2014/11/20/add-blog-copyright/</id>
    <published>2014-11-20T03:03:51.000Z</published>
    <updated>2016-03-05T05:47:11.165Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;相信大多数人开博客的目的在于分享，在分享的过程中发现问题，共同进步。但是自己辛辛苦苦码字得到的一篇文章，还是希望能够打上自己的标签，这就涉及到如何给自己博客添加版权信息的问题。其实，Octopress高度模块化的设计理念，让我们很容易对自己的博客进行定制。我们要做的就是在响应模块，添加版权信息即可。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;添加自定义样式&quot;&gt;&lt;a href=&quot;#添加自定义样式&quot; class=&quot;headerlink&quot; title=&quot;添加自定义样式&quot;&gt;&lt;/a&gt;添加自定义样式&lt;/h2&gt;&lt;p&gt;Octopress所有样式都保存在&lt;code&gt;$OCTOPRESS_HOME/sass&lt;/code&gt;目录下。在有自定义需求的地方，Octopress都为我们准备了&lt;code&gt;custom&lt;/code&gt;子目录，例如：&lt;br&gt;&lt;code&gt;$OCTOPRESS_HOME/sass/custom&lt;/code&gt;&lt;br&gt;&lt;code&gt;$OCTOPRESS_HOME/source/_includes/custom&lt;/code&gt;&lt;br&gt;现在，我们为版权信息模板添加一个自定义样式。&lt;br&gt;打开&lt;code&gt;$OCTOPRESS_HOME/sass/custom/_styles.scss&lt;/code&gt;文件，添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;.post-footer{margin-top:10px;padding:5px;background:none repeat scroll 0pt 0pt #eee;font-size:90%;color:gray}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里，我们添加了一个自定义样式&lt;code&gt;post-footer&lt;/code&gt;，我们将在版权信息模板中调用。&lt;/p&gt;
&lt;h2 id=&quot;添加版权信息&quot;&gt;&lt;a href=&quot;#添加版权信息&quot; class=&quot;headerlink&quot; title=&quot;添加版权信息&quot;&gt;&lt;/a&gt;添加版权信息&lt;/h2&gt;&lt;p&gt;我们希望为每篇博客都添加版权信息，因此需要在博客模板中修改。&lt;br&gt;打开&lt;code&gt;$OCTOPRESS_HOME/source/_layouts/post.html&lt;/code&gt;文件，在&lt;code&gt;&amp;lt;footer&amp;gt;&lt;/code&gt;节点下添加内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;p class=&amp;quot;post-footer&amp;quot;&amp;gt;
  {% if page.categories contains &quot;reprints&quot; %}
      {% else %}
          原文链接：
          &lt;a href=&quot;http://aaronchansunny.github.io/{{page.url}}&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://aaronchansunny.github.io/{{page.url}}&lt;/a&gt;
      {% endif %}
&amp;lt;/p&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解释下这段代码：当博客类别不属于&lt;code&gt;reprints&lt;/code&gt;时（&lt;code&gt;reprints&lt;/code&gt;属于转载的博客，转载自然不能添加版权信息啦！），Octopress将自动在博客末尾添加版权信息。该版权信息模块调用了之前我们自定义的&lt;code&gt;post-footer&lt;/code&gt;样式，例子中仅仅附上原文链接，具体内容大家可以进行自定义。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      给Octopress每篇博客添加版权信息
    
    </summary>
    
    
      <category term="Octopress" scheme="http://yoursite.com/tags/Octopress/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat集群Session共享的轻量级解决方案Memcached</title>
    <link href="http://yoursite.com/2014/11/19/session-shared-based-on-memcached/"/>
    <id>http://yoursite.com/2014/11/19/session-shared-based-on-memcached/</id>
    <published>2014-11-19T08:27:56.000Z</published>
    <updated>2016-03-05T05:47:11.163Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;h3 id=&quot;Session是什么&quot;&gt;&lt;a href=&quot;#Session是什么&quot; class=&quot;headerlink&quot; title=&quot;Session是什么&quot;&gt;&lt;/a&gt;Session是什么&lt;/h3&gt;&lt;p&gt;用户访问服务器资源主要分成两类，一类是无状态访问，例如请求一张图片。另一类是有状态访问，这种情况下，服务器需要记录追踪用户状态，并根据用户所处状态做出不同响应，典型的例子是购物车。Session的作用就是在Web服务器上保持用户的状态信息。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Tomcat集群为什么需要Session共享&quot;&gt;&lt;a href=&quot;#Tomcat集群为什么需要Session共享&quot; class=&quot;headerlink&quot; title=&quot;Tomcat集群为什么需要Session共享&quot;&gt;&lt;/a&gt;Tomcat集群为什么需要Session共享&lt;/h3&gt;&lt;p&gt;当客户端访问Tomcat集群时，所有的请求将被Nginx拦截，由Nginx做负载均衡后转发给后台真实Tomcat。按照这个流程就可能出现一个问题，当用户进行页面刷新或跳转时，每次请求将被转发给不同的Tomcat处理，这样就会造成Session的不同步。举个简单的栗子，例如当用户往购物车添加商品时，兴高采烈地准备买单了，当他跳转到付款页面却发现购物车被清空了，这就是Session丢失的典型栗子。因此，我们需要为集群环境做Session同步。&lt;/p&gt;
&lt;h3 id=&quot;Session共享方案讨论&quot;&gt;&lt;a href=&quot;#Session共享方案讨论&quot; class=&quot;headerlink&quot; title=&quot;Session共享方案讨论&quot;&gt;&lt;/a&gt;Session共享方案讨论&lt;/h3&gt;&lt;p&gt;在服务器集群的环境下，共享Session的方案主要分为4类：  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用户端本地保存Cookie  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在这种方式下，Web应用会将用户状态写到Cookie并保存到用户本地。但是，如果用户使用的浏览器不支持Cookie或者禁用Cookie，该方案将会失效。并且Cookie能保存的数据是有大小限制的，而且数据暴露给用户本地浏览器，存在安全性问题。 &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;采用数据库方式保存Session  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;相对本地Cookie方式，将用户信息保存到服务端数据库解决了数据安全性问题。然而，这么做是有代价的，应用中所有对Session的访问都必须经过数据库，加大数据库负担，导致系统整体性能降低。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;代理服务器  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;通过代理服务器实现Session共享的思路非常简单，就是Session数据在哪台Tomcat，之后的请求都转发到这台Tomcat。例如Nginx，具体实现只需要修改转发规则为&lt;code&gt;ip_hash&lt;/code&gt;即可。但这时候可能存在某一时间段大量用户始终访问某台Tomcat的负载很大，也就失去了负载均衡的意义。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;搭建缓存服务器  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这种方案也是应用最普遍的方案，通过搭建缓存服务器，并使用第三方工具接管Tomcat对Session的管理。&lt;br&gt;本文例子采用方案4进行Session管理，使用的缓存服务器是Memcached，并使用memcached-session-manager管理Session。memcached-session-manager（以下简称msm）的使用方法很简单，只需要根据Tomcat版本和序列化方式下载相应jar包，拷贝至Tomcat的lib目录下，最后修改Tomcat配置文件，更换Session管理模块即可。&lt;/p&gt;
&lt;h2 id=&quot;原型环境&quot;&gt;&lt;a href=&quot;#原型环境&quot; class=&quot;headerlink&quot; title=&quot;原型环境&quot;&gt;&lt;/a&gt;原型环境&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;1XX.XX.XX.181  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;运行Nginx、Tomcat和Tomcat1  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1XX.XX.XX.182   &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;运行Memcached&lt;br&gt;其中1XX.XX.XX.181主机搭建Tomcat集群环境，1XX.XX.XX.182主机搭建缓存服务器。&lt;br&gt;服务器环境： &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# cat /etc/redhat-release 
CentOS release 6.5 (Final)
# uname -a
Linux chenllcentos.localdomain 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;安装Memcached&quot;&gt;&lt;a href=&quot;#安装Memcached&quot; class=&quot;headerlink&quot; title=&quot;安装Memcached&quot;&gt;&lt;/a&gt;安装Memcached&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://memcached.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Memcached&lt;/a&gt;是一个高性能的分布式缓存系统，进入&lt;a href=&quot;http://memcached.org/downloads&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下载页面&lt;/a&gt;下载最新稳定版本。或者，可以通过&lt;code&gt;wget&lt;/code&gt;下载：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# wget http://memcached.org/latest
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;安装Memcached之前，需要安装libevent-devel依赖：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yum -y install libevent-devel
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解压并安装：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# tar -zxvf memcached-1.x.x.tar.gz
# cd memcached-1.x.x
# ./configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make test &amp;amp;&amp;amp; sudo make install
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;启动&lt;code&gt;memcached&lt;/code&gt;运行命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# /usr/local/memcached-1.4.21/bin/memcached -d -uroot -m 1024 -P /usr/local/memcached-1.4.21/memcached.pid
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里&lt;code&gt;-d&lt;/code&gt;参数表示开启守护线程，&lt;code&gt;-u&lt;/code&gt;参数指定用户，&lt;code&gt;-m&lt;/code&gt;参数指定分配给&lt;code&gt;memcached&lt;/code&gt;的内存大小。更多启动参数如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;-d 选项是启动一个守护进程
-m 是分配给Memcache使用的内存数量，单位是MB，这里是1024MB，默认是64MB
-u 是运行Memcache的用户，这里是root
-l 是监听的服务器IP地址，默认应该是本机
-p 是设置Memcache监听的端口，默认是11211，最好是1024以上的端口
-c 选项是最大运行的并发连接数，默认是1024，这里设置了10240，按照你服务器的负载量来设定
-P 是设置保存Memcache的pid文件位置
-h 打印帮助信息
-v 输出警告和错误信息
-vv 打印客户端的请求和返回信息
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看端口状态：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos bin]# netstat -ntlp | grep memcached
tcp        0      0 0.0.0.0:11211               0.0.0.0:*                   LISTEN      2222/memcached      
tcp        0      0 :::11211                    :::*                        LISTEN      2222/memcached      
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在集群环境中，Tomcat需要访问缓存服务器读取并更新Session信息，因此缓存服务器需要对&lt;code&gt;11211&lt;/code&gt;端口放行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# vi /etc/sysconfig/iptables
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 放行Memcached端口
-A INPUT -m state --state NEW -m tcp -p tcp --dport 11211 -j ACCEPT
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启&lt;code&gt;iptables&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# service iptables restart
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;停止&lt;code&gt;memcached&lt;/code&gt;通过&lt;code&gt;kill&lt;/code&gt;命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# kill `cat /usr/local/memcached-1.4.21/memcached.pid`
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;Tomcat配置msm&quot;&gt;&lt;a href=&quot;#Tomcat配置msm&quot; class=&quot;headerlink&quot; title=&quot;Tomcat配置msm&quot;&gt;&lt;/a&gt;Tomcat配置msm&lt;/h2&gt;&lt;p&gt;msm是托管在GoogleCode的一个开源项目，项目详细介绍可以查阅&lt;a href=&quot;https://code.google.com/p/memcached-session-manager/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Tomcat high-availability clusters with memcached&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&quot;拷贝jar包&quot;&gt;&lt;a href=&quot;#拷贝jar包&quot; class=&quot;headerlink&quot; title=&quot;拷贝jar包&quot;&gt;&lt;/a&gt;拷贝jar包&lt;/h3&gt;&lt;p&gt;使用msm之前，需要拷贝一下jars到&lt;code&gt;$TOMCAT_HOME/lib&lt;/code&gt;目录：&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/de/javakaffee/msm/memcached-session-manager/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;memcached-session-manager-${version}.jar&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/de/javakaffee/msm/memcached-session-manager-tc8/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;memcached-session-manager-tc8-${version}.jar&lt;/a&gt;  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;该jar包需要和Tomcat版本一致。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/net/spy/spymemcached/2.11.1/spymemcached-2.11.1.jar&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;spymemcached-2.11.1.jar&lt;/a&gt;&lt;br&gt;这里选择&lt;code&gt;kryo-serializer&lt;/code&gt;作为序列化策略，因此还需要添加如下用于实现对象序列化的jar包:&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/de/javakaffee/msm/msm-kryo-serializer/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;msm-kryo-serializer&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/de/javakaffee/kryo-serializers/0.11/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kryo-serializers-0.11&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/com/googlecode/kryo/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kryo&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/com/googlecode/minlog/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;minlog&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/com/googlecode/reflectasm/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reflectasm&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/asm/asm/3.2/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;asm-3.2&lt;/a&gt;&lt;br&gt;最后，还需要添加&lt;code&gt;javolution-serializer&lt;/code&gt;所需jar包：&lt;br&gt;&lt;a href=&quot;http://repo1.maven.org/maven2/de/javakaffee/msm/msm-javolution-serializer/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;msm-javolution-serializer&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://memcached-session-manager.googlecode.com/svn/maven/javolution/javolution/5.4.3.1/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;javolution-5.4.3.1&lt;/a&gt;  &lt;/p&gt;
&lt;h3 id=&quot;修改Tomcat配置文件&quot;&gt;&lt;a href=&quot;#修改Tomcat配置文件&quot; class=&quot;headerlink&quot; title=&quot;修改Tomcat配置文件&quot;&gt;&lt;/a&gt;修改Tomcat配置文件&lt;/h3&gt;&lt;p&gt;修改&lt;code&gt;$TOMCAT_HOME/conf/context.xml&lt;/code&gt;配置文件，新增如下信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;Context&amp;gt;
    ...
    &amp;lt;!-- Memcached管理集群session  --&amp;gt;
    &amp;lt;Manager className=&amp;quot;de.javakaffee.web.msm.MemcachedBackupSessionManager&amp;quot;
          memcachedNodes=&amp;quot;n1:1XX.XX.XX.182:11211&amp;quot;
          sticky=&amp;quot;false&amp;quot;
          lockingMode=&amp;quot;auto&amp;quot;
          sessionBackupAsync=&amp;quot;false&amp;quot;
          sessionBackupTimeout=&amp;quot;1000&amp;quot;
          transcoderFactoryClass=&amp;quot;de.javakaffee.web.msm.serializer.kryo.KryoTranscoderFactory&amp;quot;  /&amp;gt;
    ...
&amp;lt;/Context&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;几点说明：  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;其中memcachedNodes表示memcached节点信息,多个节点以空隔分开；  &lt;/li&gt;
&lt;li&gt;sticky指定Session共享模式；  &lt;/li&gt;
&lt;li&gt;sessionBackupTimeout的单位为分钟。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;分别启动主机1XX.XX.XX.181的Nginx、Tomcat和Tomcat1，启动主机1XX.XX.XX.182的Memcached服务器。&lt;/p&gt;
&lt;h2 id=&quot;Session共享测试&quot;&gt;&lt;a href=&quot;#Session共享测试&quot; class=&quot;headerlink&quot; title=&quot;Session共享测试&quot;&gt;&lt;/a&gt;Session共享测试&lt;/h2&gt;&lt;p&gt;为了测试Nginx集群是否实现session共享，让index.jsp打印Session信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SessionID:&amp;lt;%=session.getId()%&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;打开浏览器访问，如果配置正确可得到如下以&lt;code&gt;-n1&lt;/code&gt;为结尾的Session串：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SessionID:2F712A985872A8688138D293F59E493A-n1.tomcat 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;刷新浏览器，可以发现Session并不会发生变化，说明通过Memcached实现Session共享有效。如果我们关闭主机1XX.XX.XX.182的缓存服务器呢？&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# kill `cat /usr/local/memcached-1.4.21/memcached.pid`
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;再刷新浏览器看看，将出现类似如下格式的Session串：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SessionID:E914205336C4FE5A386702F2B6D65063.tomcat 
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;注意：&lt;br&gt;如果刷新后仍然出现以以&lt;code&gt;-n1&lt;/code&gt;为结尾的Session串，等待几秒后再试试。这是因为关闭缓存服务器需要时间，如果马上刷新Tomcat集群还是能从缓存服务器取到Session。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;可以发现&lt;code&gt;-n1&lt;/code&gt;结尾消失了，说明Session共享已经失效，并且反复刷新浏览器，Session的值在不断变化。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      Tomcat集群Session共享的轻量级解决方案Memcached
    
    </summary>
    
    
      <category term="Server" scheme="http://yoursite.com/tags/Server/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat集群性能测试与分析</title>
    <link href="http://yoursite.com/2014/11/19/tomcat-cluster-benchmark-test/"/>
    <id>http://yoursite.com/2014/11/19/tomcat-cluster-benchmark-test/</id>
    <published>2014-11-19T03:00:47.000Z</published>
    <updated>2016-03-05T05:47:11.164Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;在&lt;a href=&quot;http://aaronchansunny.github.io/blog/2014/11/18/nginx-tomcat-cluster/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;使用Nginx反向代理Tomcat并实现负载均衡&lt;/a&gt;博客中，我们使用Nginx搭建Tomcat简单集群，并实现负载均衡。之所有进行Web服务器集群，就是希望能够达到水平扩展的目的。当集群中新增新的Web服务器，理论上整个Web应用的并发量就能得到线性增长。现在以简单的注册为例，来验证我们之前的集群方案是否有效。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;测试环境&quot;&gt;&lt;a href=&quot;#测试环境&quot; class=&quot;headerlink&quot; title=&quot;测试环境&quot;&gt;&lt;/a&gt;测试环境&lt;/h2&gt;&lt;p&gt;1.1XX.XX.XX.181&lt;br&gt;运行Nginx、Tomcat和MySQL&lt;br&gt;2.1XX.XX.XX.182&lt;br&gt;运行Tomcat&lt;br&gt;1XX.XX.XX.183&lt;br&gt;运行Tomcat&lt;br&gt;服务器环境：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /etc/redhat-release 
CentOS release 6.5 (Final)
[root@chenllcentos ~]# uname -a
Linux chenllcentos.localdomain 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;部署应用&quot;&gt;&lt;a href=&quot;#部署应用&quot; class=&quot;headerlink&quot; title=&quot;部署应用&quot;&gt;&lt;/a&gt;部署应用&lt;/h2&gt;&lt;p&gt;将Web项目文件分别拷贝至服务器1XX.XX.XX.181、1XX.XX.XX.182和1XX.XX.XX.183，这里放在&lt;code&gt;/data0/htdocs/www&lt;/code&gt;目录下。&lt;br&gt;接下来，设置Tomcat配置文件的虚拟目录如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /usr/local/tomcat/conf/server.xml | grep appBase
      &amp;lt;Host name=&amp;quot;localhost&amp;quot;  appBase=&amp;quot;/data0/htdocs/www/&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;Tomcat集群测试&quot;&gt;&lt;a href=&quot;#Tomcat集群测试&quot; class=&quot;headerlink&quot; title=&quot;Tomcat集群测试&quot;&gt;&lt;/a&gt;Tomcat集群测试&lt;/h2&gt;&lt;p&gt;现在通过模拟1000用户并发执行注册操作，持续时间30秒来测试服务器集群性能，同时打印系统资源占用信息。测试AB命令如下；&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab -c1000 -t30 -p /data/post.txt http://1XX.XX.XX.181/chatMeServer/chatMeAction_registration.rjaction
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;1台Tomcat性能&quot;&gt;&lt;a href=&quot;#1台Tomcat性能&quot; class=&quot;headerlink&quot; title=&quot;1台Tomcat性能&quot;&gt;&lt;/a&gt;1台Tomcat性能&lt;/h3&gt;&lt;p&gt;首先只启动1XX.XX.XX.182主机Tomcat一台Web服务器，测试数据如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Concurrency Level:      1000
Time taken for tests:   30.000 seconds
Complete requests:      14843
Failed requests:        0
Write errors:           0
Total transferred:      5640340 bytes
Total POSTed:           3564675
HTML transferred:       1513986 bytes
Requests per second:    494.76 [#/sec] (mean)
Time per request:       2021.163 [ms] (mean)
Time per request:       2.021 [ms] (mean, across all concurrent requests)
Transfer rate:          183.60 [Kbytes/sec] received
                        116.04 kb/s sent
                        299.64 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    6  20.5      0     102
Processing:   103 1947 353.9   2008    3379
Waiting:      102 1947 353.9   2007    3379
Total:        204 1953 348.6   2008    3455
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.181系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all      5.82      0.00     28.84      0.00      0.26     65.08
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.182系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     37.07      0.00     24.80      0.00      0.27     37.87
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;2台Tomcat性能&quot;&gt;&lt;a href=&quot;#2台Tomcat性能&quot; class=&quot;headerlink&quot; title=&quot;2台Tomcat性能&quot;&gt;&lt;/a&gt;2台Tomcat性能&lt;/h3&gt;&lt;p&gt;接下来启动1XX.XX.XX.183主机Tomcat服务器，现在共运行2台Web服务器，测试数据如下；&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Concurrency Level:      1000
Time taken for tests:   30.000 seconds
Complete requests:      25312
Failed requests:        0
Write errors:           0
Keep-Alive requests:    0
Total transferred:      9618560 bytes
Total POSTed:           6551439
HTML transferred:       2581824 bytes
Requests per second:    843.73 [#/sec] (mean)
Time per request:       1185.220 [ms] (mean)
Time per request:       1.185 [ms] (mean, across all concurrent requests)
Transfer rate:          313.10 [Kbytes/sec] received
                        213.26 kb/s sent
                        526.36 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    3  15.4      0     113
Processing:     5 1141 1139.4    650    3879
Waiting:        5 1140 1139.4    650    3878
Total:          6 1144 1140.2    703    3916
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.181系统（运行Nginx和Mysql）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     10.05      0.00     47.09      0.00      0.26     42.59
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.182（运行Tomcat）系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     36.22      0.00     23.24      0.00      0.27     40.27
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.183系统（运行Tomcat）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     52.86      0.00     22.92      0.00      0.26     23.96
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;###3台Tomcat性能&lt;br&gt;如果主机1XX.XX.XX.183再开一个Tomcat实例呢？测试数据：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Concurrency Level:      1000
Time taken for tests:   30.000 seconds
Complete requests:      42718
Failed requests:        0
Write errors:           0
Keep-Alive requests:    0
Total transferred:      16243430 bytes
Total POSTed:           10885284
HTML transferred:       4357236 bytes
Requests per second:    1423.93 [#/sec] (mean)
Time per request:       702.283 [ms] (mean)
Time per request:       0.702 [ms] (mean, across all concurrent requests)
Transfer rate:          528.76 [Kbytes/sec] received
                        354.34 kb/s sent
                        883.09 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    2  11.6      0     109
Processing:     3  685 831.2    431    7105
Waiting:        2  685 831.2    430    7105
Total:          3  687 834.8    434    7201
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.181系统（运行Nginx和Mysql）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     10.05      0.00     47.09      0.00      0.26     42.59
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.182（运行Tomcat）系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     36.22      0.00     23.24      0.00      0.27     40.27
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.183系统（运行Tomcat和Tomcat1）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     66.00      0.00     33.50      0.00      0.00      0.50 ---&amp;gt;CPU达到瓶颈
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以发现，此时主机1XX.XX.XX.183的CPU达到瓶颈。从AB测试结果&lt;code&gt;Complete requests&lt;/code&gt;和&lt;code&gt;Time per request&lt;/code&gt;看，虽然多运行了一个Tomcat实例，但由于1XX.XX.XX.183主机CPU已经达到瓶颈，整个集群的性能并没有成线性增长。&lt;br&gt;如果将第三台Tomcat搭建在1XX.XX.XX.181主机呢？测试数据：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Concurrency Level:      1000
Time taken for tests:   30.018 seconds
Complete requests:      33026
Failed requests:        0
Write errors:           0
Keep-Alive requests:    0
Total transferred:      12622460 bytes
Total POSTed:           8389557
HTML transferred:       3388134 bytes
Requests per second:    1100.21 [#/sec] (mean)
Time per request:       908.914 [ms] (mean)
Time per request:       0.909 [ms] (mean, across all concurrent requests)
Transfer rate:          410.64 [Kbytes/sec] received
                        272.94 kb/s sent
                        683.58 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0  151 159.1    116    1359
Processing:     3  746 887.7    452    7192
Waiting:        3  694 887.5    385    7183
Total:          3  896 888.1    665    7257
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.181系统（运行Nginx、Tomcat和Mysql）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     56.64      0.00     43.11      0.00      0.25      0.00 ---&amp;gt;CPU达到瓶颈
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.182（运行Tomcat）系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     29.54      0.00     15.18      0.00      0.27     55.01
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.183系统（运行Tomcat）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     25.74      0.00     17.69      0.00      0.27     56.30
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通过&lt;code&gt;sar&lt;/code&gt;数据可以知道，此时主机1XX.XX.XX.181的CPU已达到瓶颈，性能也没有成比例增长。  &lt;/p&gt;
&lt;h3 id=&quot;测试小结&quot;&gt;&lt;a href=&quot;#测试小结&quot; class=&quot;headerlink&quot; title=&quot;测试小结&quot;&gt;&lt;/a&gt;测试小结&lt;/h3&gt;&lt;p&gt;通过上述测试结果可以看出，只要物理主机资源还未达到瓶颈，&lt;code&gt;Complete requests&lt;/code&gt;和&lt;code&gt;Time per request&lt;/code&gt;都能得到近乎线性的增长，因此可以证明我们的集群方案是有效的。&lt;/p&gt;
&lt;h2 id=&quot;使用Tomcat集群提高并发数&quot;&gt;&lt;a href=&quot;#使用Tomcat集群提高并发数&quot; class=&quot;headerlink&quot; title=&quot;使用Tomcat集群提高并发数&quot;&gt;&lt;/a&gt;使用Tomcat集群提高并发数&lt;/h2&gt;&lt;p&gt;使用AB测试工具模拟1万用户同时并发注册的情况，持续时间30秒：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab -c10000 -t30 -k -p /data/post.txt http://1XX.XX.XX.181/chatMeServer/chatMeAction_registration.rjaction
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;1台Tomcat性能-1&quot;&gt;&lt;a href=&quot;#1台Tomcat性能-1&quot; class=&quot;headerlink&quot; title=&quot;1台Tomcat性能&quot;&gt;&lt;/a&gt;1台Tomcat性能&lt;/h3&gt;&lt;p&gt;1台Tomcat的测试数据：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Concurrency Level:      10000
Time taken for tests:   30.000 seconds
Complete requests:      13791
Failed requests:        11 ---&amp;gt;出现请求响应失败
   (Connect: 0, Receive: 0, Length: 11, Exceptions: 0)
Write errors:           0
Non-2xx responses:      11
Keep-Alive requests:    11
Total transferred:      5240008 bytes
Total POSTed:           5923710
HTML transferred:       1407452 bytes
Requests per second:    459.70 [#/sec] (mean)
Time per request:       21753.394 [ms] (mean)
Time per request:       2.175 [ms] (mean, across all concurrent requests)
Transfer rate:          170.57 [Kbytes/sec] received
                        192.83 kb/s sent
                        363.40 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0  408 340.2    388    1030
Processing:     1 13053 5949.5  14975   26485
Waiting:        1 13052 5949.7  14975   26485
Total:          2 13460 5715.0  15317   26765
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.181系统（运行Nginx和Mysql）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all      7.20      0.00     27.20      0.00      0.00     65.60
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.182（运行Tomcat）系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     36.31      0.00     25.75      0.00      0.00     37.94
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以看出，此时Tomcat出现11次请求响应失败。我们往集群新增一台Tomcat，看是否能解决响应失败问题。  &lt;/p&gt;
&lt;h3 id=&quot;2台Tomcat性能-1&quot;&gt;&lt;a href=&quot;#2台Tomcat性能-1&quot; class=&quot;headerlink&quot; title=&quot;2台Tomcat性能&quot;&gt;&lt;/a&gt;2台Tomcat性能&lt;/h3&gt;&lt;p&gt;2台Tomcat的测试数据：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Concurrency Level:      10000
Time taken for tests:   30.002 seconds
Complete requests:      24053 ---&amp;gt;给定时间处理的请求量成比例增长，说明负载均衡有效
Failed requests:        0 ---&amp;gt;解决了请求失败问题
Write errors:           0
Keep-Alive requests:    0
Total transferred:      9143180 bytes
Total POSTed:           8478201
HTML transferred:       2454222 bytes
Requests per second:    801.71 [#/sec] (mean)
Time per request:       12473.334 [ms] (mean)
Time per request:       1.247 [ms] (mean, across all concurrent requests)
Transfer rate:          297.61 [Kbytes/sec] received
                        275.96 kb/s sent
                        573.57 kb/s total

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0  244 317.4      8    1004
Processing:   274 9617 2913.4  10995   16630
Waiting:      268 9616 2913.8  10994   16629
Total:        688 9861 2674.2  11020   16931
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.181系统（运行Nginx和Mysql）资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     20.82      0.00     49.36      0.51      0.51     28.79
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.182（运行Tomcat）系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     36.96      0.00     22.55      0.00      0.00     40.49
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主机1XX.XX.XX.183（运行Tomcat）系统资源占用：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# sar -u 1
CPU     %user     %nice   %system   %iowait    %steal     %idle
all     55.73      0.00     21.88      0.00      0.00     22.40
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此时不仅&lt;code&gt;Complete requests&lt;/code&gt;成比例增长，同时也解决了服务器响应请求失败的问题，说明Tomcat集群有效。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      Tomcat集群性能测试与分析
    
    </summary>
    
    
      <category term="Server" scheme="http://yoursite.com/tags/Server/"/>
    
  </entry>
  
  <entry>
    <title>使用Apache Benchmark测试Web服务器性能</title>
    <link href="http://yoursite.com/2014/11/19/apache-benchmark-test/"/>
    <id>http://yoursite.com/2014/11/19/apache-benchmark-test/</id>
    <published>2014-11-19T02:14:38.000Z</published>
    <updated>2016-03-05T05:47:11.162Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;当Web应用正式上线之前，对Web服务器性能的预估是必不可少的。为了让运维人员对服务器的性能瓶颈有基本预估，需要对服务器进行压力测试。&lt;br&gt;工欲善其事，必先利其器。Apache Benchmark（以下简称AB）作为Apache旗下的Http Server性能评测工具，使用方法非常简单，并且在高并发的情况下并不会占用太多系统资源。此外，AB可以直接在Web服务器本地发起测试请求。这点至关重要，因为我们希望测试的是服务器处理时间，而不包含数据的网络传输时间以及用户PC本地的计算时间。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;测试环境&quot;&gt;&lt;a href=&quot;#测试环境&quot; class=&quot;headerlink&quot; title=&quot;测试环境&quot;&gt;&lt;/a&gt;测试环境&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /etc/redhat-release 
CentOS release 6.5 (Final)
[root@chenllcentos ~]# uname -a
Linux chenllcentos.localdomain 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;安装AB&quot;&gt;&lt;a href=&quot;#安装AB&quot; class=&quot;headerlink&quot; title=&quot;安装AB&quot;&gt;&lt;/a&gt;安装AB&lt;/h2&gt;&lt;p&gt;在CentOS下可以通过&lt;code&gt;yum&lt;/code&gt;安装AB：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;yum -y install httpd-tools
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;基本使用&quot;&gt;&lt;a href=&quot;#基本使用&quot; class=&quot;headerlink&quot; title=&quot;基本使用&quot;&gt;&lt;/a&gt;基本使用&lt;/h2&gt;&lt;p&gt;AB安装完毕，最简单的使用方法是：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab http://www.baidu.com/
[root@chenllcentos ~]# ab http://www.baidu.com/
This is ApacheBench, Version 2.3 &amp;lt;$Revision: 655654 $&amp;gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking www.baidu.com (be patient).....done


Server Software:        BWS/1.1
Server Hostname:        www.baidu.com
Server Port:            80

Document Path:          /
Document Length:        82654 bytes

Concurrency Level:      1
Time taken for tests:   0.242 seconds
Complete requests:      1
Failed requests:        0
Write errors:           0
Total transferred:      83528 bytes
HTML transferred:       82654 bytes
Requests per second:    4.14 [#/sec] (mean)
Time per request:       241.761 [ms] (mean)
Time per request:       241.761 [ms] (mean, across all concurrent requests)
Transfer rate:          337.40 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:       15   15   0.0     15      15
Processing:   215  215   0.0    215     215
Waiting:       25   25   0.0     25      25
Total:        230  230   0.0    230     230
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;上述测试结果参数说明：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Server Software:        web服务器软件及版本
Server Hostname:        请求的地址
Server Port:            请求的端口

Document Path:          请求的页面路径
Document Length:        页面大小

Concurrency Level:      并发数
Time taken for tests:   测试总共花费的时间
Complete requests:      完成的请求数
Failed requests:        失败的请求数
Write errors:           写入错误
Total transferred:      总共传输字节数，包含http的头信息等
HTML transferred:       html字节数，实际的页面传递字节数
Requests per second:    每秒处理的请求数，服务器的吞吐量（重要）
Time per request:       平均数，用户平均请求等待时间
Time per request:       服务器平均处理时间
Transfer rate:          平均传输速率（每秒收到的速率）
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;AB运行参数&quot;&gt;&lt;a href=&quot;#AB运行参数&quot; class=&quot;headerlink&quot; title=&quot;AB运行参数&quot;&gt;&lt;/a&gt;AB运行参数&lt;/h2&gt;&lt;p&gt;接下来，让我们看看&lt;code&gt;ab&lt;/code&gt;详细使用参数，直接输入&lt;code&gt;ab&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab
ab: wrong number of arguments
Usage: ab [options] [http[s]://]hostname[:port]/path
Options are:
    -n requests     Number of requests to perform
    -c concurrency  Number of multiple requests to make
    -t timelimit    Seconds to max. wait for responses
    -b windowsize   Size of TCP send/receive buffer, in bytes
    -p postfile     File containing data to POST. Remember also to set -T
    -u putfile      File containing data to PUT. Remember also to set -T
    -T content-type Content-type header for POSTing, eg.
                    &amp;apos;application/x-www-form-urlencoded&amp;apos;
                    Default is &amp;apos;text/plain&amp;apos;
    -v verbosity    How much troubleshooting info to print
    -w              Print out results in HTML tables
    -i              Use HEAD instead of GET
    -x attributes   String to insert as table attributes
    -y attributes   String to insert as tr attributes
    -z attributes   String to insert as td or th attributes
    -C attribute    Add cookie, eg. &amp;apos;Apache=1234. (repeatable)
    -H attribute    Add Arbitrary header line, eg. &amp;apos;Accept-Encoding: gzip&amp;apos;
                    Inserted after all normal header lines. (repeatable)
    -A attribute    Add Basic WWW Authentication, the attributes
                    are a colon separated username and password.
    -P attribute    Add Basic Proxy Authentication, the attributes
                    are a colon separated username and password.
    -X proxy:port   Proxyserver and port number to use
    -V              Print version number and exit
    -k              Use HTTP KeepAlive feature
    -d              Do not show percentiles served table.
    -S              Do not show confidence estimators and warnings.
    -g filename     Output collected data to gnuplot format file.
    -e filename     Output CSV file with percentages served
    -r              Don&amp;apos;t exit on socket receive errors.
    -h              Display usage information (this message)
    -Z ciphersuite  Specify SSL/TLS cipher suite (See openssl ciphers)
    -f protocol     Specify SSL/TLS protocol (SSL2, SSL3, TLS1, or ALL)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;例如现在要模拟10次请求百度首页：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab -n10 http://www.baidu.com/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果要模拟并发呢？可以新增&lt;code&gt;-c&lt;/code&gt;参数。例如模拟10个用户同时并发，一共请求10次百度首页：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab -c10 -n10 http://www.baidu.com/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;一个网站的访问高峰期是最考验服务器性能的，因此进行压力测试的关键是评估好高峰期的服务器性能。幸运的是，AB为我们提供了&lt;code&gt;-t&lt;/code&gt;参数，用来模拟在给定时间内的并发行为。例如模拟100个用户并发请求，持续时间60秒，可通过如下命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab -c100 -t60 http://www.baidu.com/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用户访问页面不单单请求静态页面，更多时候需要传递请求参数。如果是GET请求，直接在url末尾添加请求参数即可；如果是POST请求，可通过&lt;code&gt;-p file&lt;/code&gt;的形式向AB传递POST请求参数。例如：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ab -p /data/post.txt http://www.yourdomain.com/test.action
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中post.txt包含了POST请求参数：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /data/post.txt 
{&amp;quot;phoneNumber&amp;quot;:&amp;quot;18888888888&amp;quot;,&amp;quot;password&amp;quot;:&amp;quot;123456&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;</content>
    
    <summary type="html">
    
      使用Apache Benchmark测试Web服务器性能
    
    </summary>
    
    
      <category term="Server" scheme="http://yoursite.com/tags/Server/"/>
    
  </entry>
  
  <entry>
    <title>使用Nginx反向代理Tomcat并实现负载均衡</title>
    <link href="http://yoursite.com/2014/11/18/nginx-tomcat-cluster/"/>
    <id>http://yoursite.com/2014/11/18/nginx-tomcat-cluster/</id>
    <published>2014-11-18T07:45:17.000Z</published>
    <updated>2016-03-05T05:47:11.161Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;随着Web应用所面对的用户群不断壮大，很快就会出现Tomcat的性能瓶颈问题。&lt;br&gt;此时面临着两种方案选择：&lt;br&gt;1.升级主机硬件配置；&lt;br&gt;2.搭建Tomcat集群。&lt;br&gt;如果选择方案1，显然将面临高成本问题。面对类似问题，通常是采取方案2的做法。单机运行Tomcat所需要的服务器硬件配置要求并不高，更重要的是可以根据需求持续增加集群规模，以达到更高的性能要求。这种情况下，方案1是不可取的，也是无法办到的。&lt;br&gt;既然需要搭建Tomcat集群，那么就需要专门的工具负责调度，Nginx就是这类工具的一种。Nginx是一款高性能的HTTP和反向代理服务器。字面上理解这句话有两层含义：&lt;br&gt;1.Nginx是一个Web服务器，在这点上和Tomcat没有任何区别；&lt;br&gt;2.Nginx还具有反向代理功能，Web服务器集群就是在此功能基础上实现的。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;反向代理&quot;&gt;&lt;a href=&quot;#反向代理&quot; class=&quot;headerlink&quot; title=&quot;反向代理&quot;&gt;&lt;/a&gt;反向代理&lt;/h2&gt;&lt;p&gt;反向代理（Reverse Proxy）方式是指以代理服务器来接受Internet上的连接请求，然后将请求转发给内部网络上的服务器；并将从服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。以上定义来自互联网。反向代理拓扑结构如图所示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;反向代理服务器通常有两种模型，它可以作为内容服务器的替身，也可以作为内容服务器集群的负载均衡器。&lt;br&gt;1.作为内容服务器替身  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;2.作为负载均衡器  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/03.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;在Tomcat集群中，用到的自然是Nginx作为负载均衡器。&lt;br&gt;以上只是对Nginx的简单介绍，若需要更多的Nginx信息，可以访问&lt;a href=&quot;http://nginx.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Nginx官网&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;Nginx安装&quot;&gt;&lt;a href=&quot;#Nginx安装&quot; class=&quot;headerlink&quot; title=&quot;Nginx安装&quot;&gt;&lt;/a&gt;Nginx安装&lt;/h2&gt;&lt;p&gt;一直牢记前辈的教诲：入门一项新技术，首先要做的是先用上它。那么，让我们先从安装Nginx开始。访问Nginx官网，进入&lt;a href=&quot;http://nginx.org/en/download.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Nginx下载页&lt;/a&gt;，选择最新的稳定版本。&lt;br&gt;本文例子所用的安装环境：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /etc/redhat-release 
CentOS release 6.5 (Final)
[root@chenllcentos ~]# uname -a
Linux chenllcentos.localdomain 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;当然，安装Nginx之前，还需要安装好编译工具和第三方依赖包：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# yum -y install gcc gcc-c++ autoconf automake
[root@chenllcentos ~]# yum -y install zlib zlib-devel openssl openssl-devel pcre pcre-devel
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接下来，开始进行Nginx源码安装。&lt;br&gt;解压Nginx安装包：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# tar zxvf nginx-1.6.2.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置编译选项，这里直接使用默认值：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# cd nginx-1.6.2
[root@chenllcentos nginx-1.6.2]# ./configure
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;关于Nginx编译选项说明，可以查阅&lt;a href=&quot;http://nginx.org/en/docs/configure.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Building nginx from Sources&lt;/a&gt;。&lt;br&gt;Nginx默认安装目录为&lt;code&gt;/usr/local/nginx&lt;/code&gt;。&lt;br&gt;编译并安装：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos nginx-1.6.2]# make &amp;amp;&amp;amp; make install
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;到此，Nginx的安装完成。&lt;br&gt;启动Nginx：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# /usr/local/nginx/sbin/nginx
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通过&lt;code&gt;ps&lt;/code&gt;查看是否启动成功：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ps -ef | grep nginx
root     31807     1  0 19:50 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx
root     31808 31807  0 19:50 ?        00:00:00 nginx: worker process      
root     31809 31807  0 19:50 ?        00:00:00 nginx: worker process      
root     31810 31807  0 19:50 ?        00:00:00 nginx: worker process      
root     31811 31807  0 19:50 ?        00:00:00 nginx: worker process      
root     31821  8578  0 19:56 pts/0    00:00:00 grep nginx
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以看到，Nginx有一个主线程&lt;code&gt;master process&lt;/code&gt;和N个工作线程&lt;code&gt;worker process&lt;/code&gt;。&lt;br&gt;Nginx启动默认加载&lt;code&gt;/usr/local/nginx/conf/nginx.conf&lt;/code&gt;配置文件，如果需要让Nginx加载我们指定的配置文件，可通过参数&lt;code&gt;-c&lt;/code&gt;实现。例如：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# /usr/local/nginx/sbin/nginx -c /data/mynginx.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;同配置Tomcat服务器相同，如果要让远程主机可以访问Nginx，需要对Nginx监听的端口放行。那么，Nginx是监听哪个端口呢？让我们通过&lt;code&gt;netstat&lt;/code&gt;看看：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# netstat -ntlp | grep nginx
tcp        0      0 0.0.0.0:80                  0.0.0.0:*                   LISTEN      31807/nginx  
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Nginx默认的监听端口是80端口，可以通过&lt;code&gt;nginx.conf&lt;/code&gt;配置文件的&lt;code&gt;listen&lt;/code&gt;参数进行更改。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /usr/local/nginx/conf/nginx.conf | grep listen
   listen       80;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改&lt;code&gt;iptables&lt;/code&gt;文件，添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 放行Nginx端口
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启&lt;code&gt;iptables&lt;/code&gt;服务：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# service iptables restart
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此时我们就能通过&lt;a href=&quot;&quot;&gt;http://youripaddress:80/&lt;/a&gt;访问Nginx了。如果配置正确，默认显示Nginx主页。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/04.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;关闭Nginx，一般情况是采用给Nginx主进程发送系统信号。例如：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# kill -QUIT `cat /usr/local/nginx/nginx.pid`
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中&lt;code&gt;nginx.pid&lt;/code&gt;是保存了Nginx主进程ID，这样就省去了查看Nginx进程号的步骤。更多的Nginx系统信号可以查阅&lt;a href=&quot;http://nginx.org/en/docs/control.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Controlling nginx&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;Nginx配置文件&quot;&gt;&lt;a href=&quot;#Nginx配置文件&quot; class=&quot;headerlink&quot; title=&quot;Nginx配置文件&quot;&gt;&lt;/a&gt;Nginx配置文件&lt;/h2&gt;&lt;p&gt;在使用Nginx作为Web服务器或反向代理服务器时，Nginx的配置文件&lt;code&gt;nginx.conf&lt;/code&gt;就是全部。Nginx的配置文件默认在Nginx安装目录的conf目录下，让我们看看它的主要组成部分。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;......
events
{
......
}

http
{
......
    server
    {
    ......
    }

    server
    {
    ......
    }
......
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;不管Nginx实现的功能有多么复杂，配置文件都是由&lt;code&gt;events&lt;/code&gt;、&lt;code&gt;http&lt;/code&gt;和&lt;code&gt;server&lt;/code&gt;这几个关键节点组成。这里先给出一个完整的配置实例，并对主要参数进行说明。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 使用的用户和组
user  root root;
# 指定工作衍生进程数（一般等于CPU的总核数或总核数的两倍，例如两个四核CPU，则总核数为8）
worker_processes 8;
# 指定错误日志存放的路径，错误日志记录级别可选项为：[ debug | info | notice | warn | error | crit ]
error_log  /data1/logs/nginx_error.log  crit;
# 指定 pid 存放的路径
pid        /usr/local/nginx/nginx.pid;

# 指定文件描述符数量
worker_rlimit_nofile 51200;

events
{
  # 使用的网络I/O模型，Linux系统推荐采用epoll模型，FreeBSD系统推荐采用kqueue模型
  use epoll;

  # 允许的连接数
  worker_connections 51200;
}

http
{
  include       mime.types;
  default_type  application/octet-stream;
  # 设置使用的字符集，如果一个网站有多种字符集，请不要随便设置，应让程序员在HTML代码中通过Meta标签设置
  #charset  gb2312;

  server_names_hash_bucket_size 128;
  client_header_buffer_size 32k;
  large_client_header_buffers 4 32k;

  # 设置客户端能够上传的文件大小
  client_max_body_size 8m;

  sendfile on;
  tcp_nopush     on;

  keepalive_timeout 60;

  tcp_nodelay on;

  fastcgi_connect_timeout 300;
  fastcgi_send_timeout 300;
  fastcgi_read_timeout 300;
  fastcgi_buffer_size 64k;
  fastcgi_buffers 4 64k;
  fastcgi_busy_buffers_size 128k;
  fastcgi_temp_file_write_size 128k;
  # 开启gzip压缩
  gzip on;
  gzip_min_length  1k;
  gzip_buffers     4 16k;
  gzip_http_version 1.1;
  gzip_comp_level 2;
  gzip_types       text/plain application/x-javascript text/css application/xml;
  gzip_vary on;

  #limit_zone  crawler  $binary_remote_addr  10m;

  server
  {
    listen       80;
    server_name  www.yourdomain.com yourdomain.com;
    index index.html index.htm index.php;
    root  /data0/htdocs;

    #limit_conn   crawler  20;

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
    {
      expires      30d;
    }

    location ~ .*\.(js|css)?$
    {
      expires      1h;
    }    

    log_format  access  &amp;apos;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;apos;
              &amp;apos;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;apos;
              &amp;apos;&amp;quot;$http_user_agent&amp;quot; $http_x_forwarded_for&amp;apos;;
    access_log  /data1/logs/access.log  access;
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中&lt;code&gt;location&lt;/code&gt;元素可以通过正则表达式，可以对Web应用做动静态资源分离和设置缓存。例子中Nginx对图片视频类资源设置缓存30天，对js和css页面资源设置缓存1小时。&lt;/p&gt;
&lt;h2 id=&quot;配置负载均衡&quot;&gt;&lt;a href=&quot;#配置负载均衡&quot; class=&quot;headerlink&quot; title=&quot;配置负载均衡&quot;&gt;&lt;/a&gt;配置负载均衡&lt;/h2&gt;&lt;p&gt;在nginx.conf配置文件中新增upstream节点，使用location拦截所有请求，规定负载均衡规后由Nginx转发给后台真实Web服务器即可实现负载均衡，达到Web服务器集群的效果。配置如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;user  root root;

worker_processes 8;

error_log  /data1/logs/nginx_error.log  crit;

pid        /usr/local/nginx/nginx.pid;

worker_rlimit_nofile 51200;

events 
{
 use epoll;
 worker_connections 51200;
}

http 
{
 include       mime.types;
 default_type  application/octet-stream;

 #charset  utf-8;

 server_names_hash_bucket_size 128;
 client_header_buffer_size 32k;
 large_client_header_buffers 4 32k;

 sendfile on;
 #tcp_nopush     on;

 keepalive_timeout 65;

 tcp_nodelay on;

 fastcgi_connect_timeout 300;
 fastcgi_send_timeout 300;
 fastcgi_read_timeout 300;
 fastcgi_buffer_size 64k;
 fastcgi_buffers 4 64k;
 fastcgi_busy_buffers_size 128k;
 fastcgi_temp_file_write_size 128k;

 gzip on;
 gzip_min_length  1k;
 gzip_buffers     4 16k;
 gzip_http_version 1.1;
 gzip_comp_level 2;
 gzip_types       text/plain application/x-javascript text/css application/xml;
 gzip_vary on;

 #limit_zone  crawler  $binary_remote_addr  10m;

 #允许客户端请求的最大单个文件字节数
 client_max_body_size     300m;

 #缓冲区代理缓冲用户端请求的最大字节数，可以理解为先保存到本地再传给用户
 client_body_buffer_size  128k;

 #跟后端服务器连接的超时时间_发起握手等候响应超时时间
 proxy_connect_timeout    600;

 #连接成功后_等候后端服务器响应时间_其实已经进入后端的排队之中等候处理
 proxy_read_timeout       600;

 #后端服务器数据回传时间_就是在规定时间内后端服务器必须传完所有的数据
 proxy_send_timeout       600;

 #代理请求缓存区_这个缓存区间会保存用户的头信息以供Nginx进行规则处理_一般只要能保存下头信息即可
 proxy_buffer_size        16k;

 #同上 告诉Nginx保存单个用的几个Buffer 最大用多大空间
 proxy_buffers            4 32k;

 #如果系统很忙的时候可以申请更大的proxy_buffers 官方推荐*2    
 proxy_busy_buffers_size 64k;

 #proxy缓存临时文件的大小
 proxy_temp_file_write_size 64k;

 upstream tomcat_server_pool {
   server   1XX.XX.XX.182:8080 weight=1 max_fails=2 fail_timeout=30s;
   server   1XX.XX.XX.182:8081 weight=1 max_fails=2 fail_timeout=30s;
   server   1XX.XX.XX.183:8080 weight=1 max_fails=2 fail_timeout=30s;
 }

 #第一个虚拟主机，反向代理tomcat_server_pool这组服务器
 server
 {
   listen       80;
   server_name  1XX.XX.XX.181;

   location /
   {
         #如果后端的服务器返回502、504、执行超时等错误，自动将请求转发到upstream负载均衡池中的另一台服务器，实现故障转移。
         proxy_next_upstream http_502 http_504 error timeout invalid_header;
         proxy_pass http://tomcat_server_pool;
         proxy_set_header Host  1XX.XX.XX.181;
         proxy_set_header X-Forwarded-For  $remote_addr;
   }

   access_log  /data1/logs/1XX.XX.XX.181_access.log;
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通过上述配置文件可以看出，Nginx运行在1XX.XX.XX.181主机并监听80端口，负责拦截所有请求并以轮询的方式将请求转发给后台3台Tomcat服务器。其中1XX.XX.XX.182主机运行2个Tomcat实例，分别监听8080端口和8081端口；1XX.XX.XX.183主机运行1个Tomcat实例，监听8080端口。由于Nginx负责将请求转发给Tomcat服务器，因此必须开放相应的监听端口。&lt;br&gt;开放1XX.XX.XX.182主机8080和8081端口：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# vi /etc/sysconfig/iptables
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 放行Tomcat端口
-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 8081 -j ACCEPT
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启&lt;code&gt;iptables&lt;/code&gt;服务：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# service iptables restart
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;同样地，开放1XX.XX.XX.183主机8080端口。现在重新访问Nginx主页&lt;a href=&quot;&quot;&gt;http://youripaddress:80/&lt;/a&gt;：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2014/11/05.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;出现Tomcat默认主页，说明Nginx反向代理成功。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      使用Nginx反向代理Tomcat并实现负载均衡
    
    </summary>
    
    
      <category term="Server" scheme="http://yoursite.com/tags/Server/"/>
    
  </entry>
  
  <entry>
    <title>Linux安装Tomcat并配置多实例</title>
    <link href="http://yoursite.com/2014/11/18/tomcat-install-linux/"/>
    <id>http://yoursite.com/2014/11/18/tomcat-install-linux/</id>
    <published>2014-11-18T05:43:26.000Z</published>
    <updated>2016-03-05T05:47:11.162Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;当考虑部署JavaWeb项目时，选择Linux服务器是大多数人的选择。Web应用必须在Web容器中运行，目前对于Web容器的选择有很多：Apache、Tomcat、IIS、Nginx和GWS等。其中Tomcat可以说是为JavaWeb应用量身定做的Web容器，又因为其轻巧并且功能强大，往往是中小型项目最好的选择。如果运用代理服务器做Tomcat集群，甚至能轻松搭建出具有高并发性能的大型Web应用。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;安装准备&quot;&gt;&lt;a href=&quot;#安装准备&quot; class=&quot;headerlink&quot; title=&quot;安装准备&quot;&gt;&lt;/a&gt;安装准备&lt;/h2&gt;&lt;p&gt;安装环境：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /etc/redhat-release 
CentOS release 6.5 (Final)
[root@chenllcentos ~]# uname -a
Linux chenllcentos.localdomain 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;安装包：&lt;br&gt;&lt;a href=&quot;http://download.oracle.com/otn-pub/java/jdk/8u25-b17/jdk-8u25-linux-x64.tar.gz&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;jdk-8u25-linux-x64&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.0.15/bin/apache-tomcat-8.0.15.tar.gz&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;apache-tomcat-8.0.15&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;##具体流程&lt;br&gt;Tomcat运行需要JDK环境支持，因此首先需要安装配置好JDK。&lt;/p&gt;
&lt;h3 id=&quot;安装JDK&quot;&gt;&lt;a href=&quot;#安装JDK&quot; class=&quot;headerlink&quot; title=&quot;安装JDK&quot;&gt;&lt;/a&gt;安装JDK&lt;/h3&gt;&lt;p&gt;安装JDK的步骤非常简单，和Windows环境下的过程类似，分成安装和配置环境变量两个步骤。这里采用源码安装的方式进行说明。&lt;br&gt;创建安装目录：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# mkdir -p /usr/local/java
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;进入JDK安装包所在目录，解压安装包：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cd ~/dev
[root@chenllcentos dev]# tar zxvf jdk-8u25-linux-x64.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;复制文件至安装目录：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# cp -rf jdk1.8.0_25/ /usr/local/java 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接下来需要配置Java环境变量，打开&lt;code&gt;etc/profile&lt;/code&gt;文件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# vi /etc/profile
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在文件末尾添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;export JAVA_HOME=/usr/local/java
export CLASS_PATH=$JAVA_HOME/lib:$JAVA_HOME/jre/lib
export PATH=.:$PATH:$JAVA_HOME/bin
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重新加载&lt;code&gt;etc/profile&lt;/code&gt;文件使其生效：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# source /etc/profile
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;验证JDK安装是否成功：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# java -version
java version &amp;quot;1.8.0_25&amp;quot;
Java(TM) SE Runtime Environment (build 1.8.0_25-b17)
Java HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;至此，JDK安装完毕。&lt;br&gt;成功安装JDK后，可以进行Tomcat安装，这里同样采用源码安装的方式进行说明。&lt;/p&gt;
&lt;h3 id=&quot;安装Tomcat&quot;&gt;&lt;a href=&quot;#安装Tomcat&quot; class=&quot;headerlink&quot; title=&quot;安装Tomcat&quot;&gt;&lt;/a&gt;安装Tomcat&lt;/h3&gt;&lt;p&gt;Tomcat源码安装和JDK安装过程类似，同样是分成安装和配置环境变量两个步骤。&lt;br&gt;创建Tomcat安装目录：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# mkdir -p /usr/local/tomcat
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;进入Tomcat安装包目录，解压安装包：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cd ~/dev
[root@chenllcentos dev]# tar zxvf apache-tomcat-8.0.15.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;复制文件至Tomcat安装目录：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# cp -rf apache-tomcat-8.0.15/ /usr/local/tomcat 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接下来同样需要为Tomcat配置环境变量，打开&lt;code&gt;etc/profile&lt;/code&gt;文件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# vi /etc/profile
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在文件末尾添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;export CATALINA_HOME=/usr/local/tomcat
export CATALINA_BASE=/usr/local/tomcat
export CATALINA_TMPDIR=/usr/local/tomcat/tmp
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重新加载&lt;code&gt;etc/profile&lt;/code&gt;文件使其生效：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# source /etc/profile
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;至此，Tomcat安装完成。现在我们试试启动Tomcat：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# /usr/local/tomcat/bin/startup.sh 
Using CATALINA_BASE:   /usr/local/tomcat
Using CATALINA_HOME:   /usr/local/tomcat
Using CATALINA_TMPDIR: /usr/local/tomcat/tmp
Using JRE_HOME:        /usr/local/jdk1.8.0_25
Using CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
Tomcat started.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;根据提示，Tomcat已经成功启动。我们通过&lt;code&gt;ps&lt;/code&gt;命令查看进程验证下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ps -ef | grep tomcat
root     30971     1 54 14:26 pts/0    00:00:31 /usr/local/jdk1.8.0_25/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/usr/local/tomcat/endorsed -classpath /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/usr/local/tomcat -Dcatalina.home=/usr/local/tomcat -Djava.io.tmpdir=/usr/local/tomcat/tmp org.apache.catalina.startup.Bootstrap start
root     31001  8578  0 14:27 pts/0    00:00:00 grep tomcat
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以看出，Tomcat确实已经启动并在后台运行。现在，我们通过&lt;code&gt;netstat&lt;/code&gt;查看端口监听状态：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# netstat -ntlp | grep java
tcp        0      0 :::8080                     :::*                        LISTEN      30971/java          
tcp        0      0 ::ffff:127.0.0.1:8005       :::*                        LISTEN      30971/java          
tcp        0      0 :::8009                     :::*                        LISTEN      30971/java    
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;根据结果显示，Tomcat进程（PID:30971）一共监听了3个端口。其中&lt;code&gt;8080&lt;/code&gt;端口大家都知道，是Tomcat默认监听端口。但是其他2个端口呢？不着急，让我们看看Tomcat配置文件&lt;code&gt;server.xml&lt;/code&gt;是怎么解释的。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /usr/local/tomcat/conf/server.xml | grep port
&amp;lt;Server port=&amp;quot;8005&amp;quot; shutdown=&amp;quot;SHUTDOWN&amp;quot;&amp;gt;
         Define a non-SSL HTTP/1.1 Connector on port 8080
    &amp;lt;Connector port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;
               port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;
    &amp;lt;!-- Define a SSL HTTP/1.1 Connector on port 8443
    &amp;lt;Connector port=&amp;quot;8443&amp;quot; protocol=&amp;quot;org.apache.coyote.http11.Http11NioProtocol&amp;quot;
    &amp;lt;!-- Define an AJP 1.3 Connector on port 8009 --&amp;gt;
    &amp;lt;Connector port=&amp;quot;8009&amp;quot; protocol=&amp;quot;AJP/1.3&amp;quot; redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;
    &amp;lt;!-- You should set jvmRoute to support load-balancing via AJP ie :
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这下就清楚了，原来&lt;code&gt;8005&lt;/code&gt;端口是Tomcat关闭端口，而&lt;code&gt;8009&lt;/code&gt;是&lt;code&gt;AJP/1.3&lt;/code&gt;协议端口。其实，Tomcat单机运行多个Tomcat实例的原理就是通过修改Tomcat监听端口实现的。&lt;br&gt;关闭Tomcat：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# /usr/local/tomcat/bin/shutdown.sh 
Using CATALINA_BASE:   /usr/local/tomcat
Using CATALINA_HOME:   /usr/local/tomcat
Using CATALINA_TMPDIR: /usr/local/tomcat/tmp
Using JRE_HOME:        /usr/local/jdk1.8.0_25
Using CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;多实例配置&quot;&gt;&lt;a href=&quot;#多实例配置&quot; class=&quot;headerlink&quot; title=&quot;多实例配置&quot;&gt;&lt;/a&gt;多实例配置&lt;/h2&gt;&lt;p&gt;如果Tomcat所部署的主机硬件性能较高，单个Tomcat实例可能造成机器性能的浪费。因此，可以考虑通过单机运行多个Tomcat实例来达到充分利用服务器物理资源的目的。为Tomcat分配不同的监听端口和启动目录即可实现单机多实例。&lt;/p&gt;
&lt;h3 id=&quot;复制安装文件&quot;&gt;&lt;a href=&quot;#复制安装文件&quot; class=&quot;headerlink&quot; title=&quot;复制安装文件&quot;&gt;&lt;/a&gt;复制安装文件&lt;/h3&gt;&lt;p&gt;首先，我们为新实例创建一个安装目录&lt;code&gt;tomcat1&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# mkdir -p /usr/local/tomcat1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;首先，需要为Tomcat实例复制Tomcat安装文件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# cp -rf /usr/local/tomcat /usr/local/tomcat1
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;修改监听端口&quot;&gt;&lt;a href=&quot;#修改监听端口&quot; class=&quot;headerlink&quot; title=&quot;修改监听端口&quot;&gt;&lt;/a&gt;修改监听端口&lt;/h3&gt;&lt;p&gt;修改tomcat1的server.xml文件，分别修改&lt;code&gt;SHUTDOWN&lt;/code&gt;、&lt;code&gt;HTTP/1.1&lt;/code&gt;和&lt;code&gt;AJP/1.3&lt;/code&gt;三个端口，修改后如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos dev]# cat /usr/local/tomcat1/conf/server.xml | grep port
&amp;lt;Server port=&amp;quot;8006&amp;quot; shutdown=&amp;quot;SHUTDOWN&amp;quot;&amp;gt;
         Define a non-SSL HTTP/1.1 Connector on port 8080
    &amp;lt;Connector port=&amp;quot;8081&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;
               port=&amp;quot;8081&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;
    &amp;lt;!-- Define a SSL HTTP/1.1 Connector on port 8443
    &amp;lt;Connector port=&amp;quot;8443&amp;quot; protocol=&amp;quot;org.apache.coyote.http11.Http11NioProtocol&amp;quot;
    &amp;lt;!-- Define an AJP 1.3 Connector on port 8009 --&amp;gt;
    &amp;lt;Connector port=&amp;quot;8010&amp;quot; protocol=&amp;quot;AJP/1.3&amp;quot; redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;
    &amp;lt;!-- You should set jvmRoute to support load-balancing via AJP ie :
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;最后一步，还需要修改启动和关闭脚本的Tomcat环境变量。  &lt;/p&gt;
&lt;h3 id=&quot;更新环境变量&quot;&gt;&lt;a href=&quot;#更新环境变量&quot; class=&quot;headerlink&quot; title=&quot;更新环境变量&quot;&gt;&lt;/a&gt;更新环境变量&lt;/h3&gt;&lt;p&gt;修改Tomcat新实例的&lt;code&gt;catalina.sh&lt;/code&gt;脚本：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# vi /usr/local/tomcat1/bin/catalina.sh
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在文件的开头添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;export CATALINA_HOME=/usr/local/tomcat1
export CATALINA_BASE=/usr/local/tomcat1
export CATALINA_TMPDIR=/usr/local/tomcat1/tmp
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;注意：此处必须在开头部分添加Tomcat环境变量，否则环境变量无法生效，导致多实例启动失败。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有些朋友可能有疑问了，我们是通过&lt;code&gt;startup.sh&lt;/code&gt;和&lt;code&gt;shutdown.sh&lt;/code&gt;来启动和关闭Tomcat的，这里为什么在&lt;code&gt;catalina.sh&lt;/code&gt;修改环境变量就能生效呢？&lt;br&gt;其实原因很简单，在执行&lt;code&gt;startup.sh&lt;/code&gt;和&lt;code&gt;shutdown.sh&lt;/code&gt;这两个脚本时，会调用&lt;code&gt;catalina.sh&lt;/code&gt;脚本。让我们验证下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# cat /usr/local/tomcat1/bin/startup.sh | grep catalina.sh
EXECUTABLE=catalina.sh
[root@chenllcentos ~]# cat /usr/local/tomcat1/bin/shutdown.sh | grep catalina.sh
EXECUTABLE=catalina.sh
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;所以，我们只需要在&lt;code&gt;catalina.sh&lt;/code&gt;脚本中配置Tomcat环境即可。  &lt;/p&gt;
&lt;h3 id=&quot;运行多实例&quot;&gt;&lt;a href=&quot;#运行多实例&quot; class=&quot;headerlink&quot; title=&quot;运行多实例&quot;&gt;&lt;/a&gt;运行多实例&lt;/h3&gt;&lt;p&gt;现在启动我们刚才配置的Tomcat新实例：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# /usr/local/tomcat1/bin/startup.sh
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看进程：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ps -ef | grep java
root     31163     1 99 15:21 pts/0    00:00:25 /usr/local/jdk1.8.0_25/bin/java -Djava.util.logging.config.file=/usr/local/tomcat1/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/usr/local/tomcat1/endorsed -classpath /usr/local/tomcat1/bin/bootstrap.jar:/usr/local/tomcat1/bin/tomcat-juli.jar -Dcatalina.base=/usr/local/tomcat1 -Dcatalina.home=/usr/local/tomcat1 -Djava.io.tmpdir=/usr/local/tomcat1/tmp org.apache.catalina.startup.Bootstrap start
root     31200     1 99 15:21 pts/0    00:00:13 /usr/local/jdk1.8.0_25/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/usr/local/tomcat/endorsed -classpath /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/usr/local/tomcat -Dcatalina.home=/usr/local/tomcat -Djava.io.tmpdir=/usr/local/tomcat/tmp org.apache.catalina.startup.Bootstrap start
root     31224  8578  0 15:21 pts/0    00:00:00 grep java
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看端口状态：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# netstat -ntlp | grep java
tcp        0      0 :::8080                     :::*                        LISTEN      31200/java          
tcp        0      0 :::8081                     :::*                        LISTEN      31163/java          
tcp        0      0 ::ffff:127.0.0.1:8005       :::*                        LISTEN      31200/java          
tcp        0      0 ::ffff:127.0.0.1:8006       :::*                        LISTEN      31163/java          
tcp        0      0 :::8009                     :::*                        LISTEN      31200/java          
tcp        0      0 :::8010                     :::*                        LISTEN      31163/java 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;单机运行多个Tomcat实例配置成功。&lt;/p&gt;
&lt;h2 id=&quot;后续&quot;&gt;&lt;a href=&quot;#后续&quot; class=&quot;headerlink&quot; title=&quot;后续&quot;&gt;&lt;/a&gt;后续&lt;/h2&gt;&lt;p&gt;到这里，Tomcat的安装和部署就全部完成了。此时可以通过浏览器访问Tomcat&lt;a href=&quot;http://localhost:8080/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;默认主页&lt;/a&gt;，不出意外都能见到可爱的小猫。那么，如果是通过远程主机的方式访问呢？&lt;br&gt;服务器IP地址；&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# ifconfig
eth0      Link encap:Ethernet  HWaddr 52:54:00:11:45:2A  
          inet addr:1XX.XX.XX.181  Bcast:1XX.XX.XX.255  Mask:255.255.255.128
......
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;结果发现，通过&lt;a href=&quot;http://1XX.XX.XX.181:8080/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://1XX.XX.XX.181:8080/&lt;/a&gt;并不能访问。原来出于服务器安全考虑，Linux自己一套防火墙机制，默认不对应用端口放行，防止非法的服务器攻击。因此，如果要使Tomcat能被远程访问，还要设置Linux防火墙，对我们配置的&lt;code&gt;HTTP/1.1&lt;/code&gt;端口放行。&lt;br&gt;打开&lt;code&gt;iptables&lt;/code&gt;文件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# vi /etc/sysconfig/iptables
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加如下内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 放行Tomcat8080端口
-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT
# 放行Tomcat18081端口
-A INPUT -m state --state NEW -m tcp -p tcp --dport 8081 -j ACCEPT
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启防火墙：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[root@chenllcentos ~]# service iptables restart
iptables：将链设置为政策 ACCEPT：filter                    [确定]
iptables：清除防火墙规则：                                 [确定]
iptables：正在卸载模块：                                   [确定]
iptables：应用防火墙规则：                                 [确定]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;现在，Tomcat就能支持远程主机访问了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      Linux安装Tomcat并配置多实例
    
    </summary>
    
    
      <category term="Server" scheme="http://yoursite.com/tags/Server/"/>
    
  </entry>
  
  <entry>
    <title>Git删除远程仓库文件</title>
    <link href="http://yoursite.com/2014/11/17/delete-remote-repo-file/"/>
    <id>http://yoursite.com/2014/11/17/delete-remote-repo-file/</id>
    <published>2014-11-17T07:58:33.000Z</published>
    <updated>2016-03-05T05:47:11.158Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;假设这么一个场景：如果已经提交某文件到远程仓库，但现在本地已经删除该文件了。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;这种情况下，输入&lt;code&gt;git status&lt;/code&gt;将提示以下信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ git status
On branch source
Your branch is up-to-date with &amp;apos;origin/source&amp;apos;.

Changes to be committed:
  (use &amp;quot;git reset HEAD &amp;lt;file&amp;gt;...&amp;quot; to unstage)

        deleted:    source/_posts/2014-11-11-master-slave-transfer.html
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中&lt;code&gt;source/_posts/2014-11-11-master-slave-transfer.html&lt;/code&gt;文件就是本地已经删除，但远程仓库还存在。怎么同步远程仓库数据库呢？&lt;br&gt;此时使用&lt;code&gt;git add .&lt;/code&gt;并不会在索引中删除这个文件，而要使用带&lt;code&gt;-a&lt;/code&gt;选项的git commit命令和带&lt;code&gt;-A&lt;/code&gt;选项的git add命令来完成。  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ git add -A
$ git commit -a -m &amp;quot;delete file 2014-11-11-master-slave-transfer.html&amp;quot;
$ git push origin source
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;提交完成后，再次&lt;code&gt;git status&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ git status
On branch source
Your branch is up-to-date with &amp;apos;origin/source&amp;apos;.

nothing to commit, working directory clean
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以发现，Git状态恢复正常，现在就可以继续使用&lt;code&gt;git add .&lt;/code&gt;进行添加了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      Git删除远程仓库文件
    
    </summary>
    
    
      <category term="Git" scheme="http://yoursite.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>解决Octopress提交博客异常</title>
    <link href="http://yoursite.com/2014/11/17/rake-deploy-error-non-fast-forward/"/>
    <id>http://yoursite.com/2014/11/17/rake-deploy-error-non-fast-forward/</id>
    <published>2014-11-17T06:55:51.000Z</published>
    <updated>2016-03-05T05:47:11.160Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;今天在Octopress进行博客提交时，出现错误：  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;To git@github.com:aaronchansunny/aaronchansunny.github.com.git
 ! [rejected]        master -&amp;gt; master (non-fast-forward)
error: failed to push some refs to &amp;apos;git@github.com:aaronchansunny/aaronchansunny.github.com.git&amp;apos;
hint: Updates were rejected because the tip of your current branch is behind
hint: its remote counterpart. Integrate the remote changes (e.g.
hint: &amp;apos;git pull ...&amp;apos;) before pushing again.
hint: See the &amp;apos;Note about fast-forwards&amp;apos; in &amp;apos;git push --help&amp;apos; for details.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;从Git字面提示来看，应该是远程仓库和本地数据版本不一致引起的。那么，解决的方法就是让本地数据同步，因此pull远程数据merge后应该能解决问题。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;解决方法&quot;&gt;&lt;a href=&quot;#解决方法&quot; class=&quot;headerlink&quot; title=&quot;解决方法&quot;&gt;&lt;/a&gt;解决方法&lt;/h2&gt;&lt;p&gt;首先，进入&lt;code&gt;_deploy&lt;/code&gt;目录：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;OA@R06270 /e/octopress (source)
$ cd _deploy/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接下来，pull远程仓库master分支数据：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;OA@R06270 /e/octopress/_deploy (master)
$ git pull origin master
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重新&lt;code&gt;rake deploy&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;OA@R06270 /e/octopress/_deploy (master)
$ cd ..
OA@R06270 /e/octopress (source)
$ rake deploy
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;问题解决。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      解决rake deploy错误
    
    </summary>
    
    
      <category term="Octopress" scheme="http://yoursite.com/tags/Octopress/"/>
    
  </entry>
  
  <entry>
    <title>给Git设置goagent代理</title>
    <link href="http://yoursite.com/2014/11/17/git-goagent/"/>
    <id>http://yoursite.com/2014/11/17/git-goagent/</id>
    <published>2014-11-17T03:06:44.000Z</published>
    <updated>2016-03-05T05:47:11.159Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;最近使用Git提交代码到仓库，经常报权限错误。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ git push origin source
Read from socket failed: Connection reset by peer
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;排查之后，权限根本没有问题，剩下的最大可能就是我朝防火墙问题了。浏览器方面一直使用的是goagent，网上关于goagent教程都是针对浏览器设置的。其实只要对代理的运行原理稍微了解的同学就知道，代理都是通过配置监听端口的方式实现的，goagent当然也不例外。因此，理论上任何应用只要配置了代理主机端口，就能正常使用代理。启动goagent可以看到如下信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;------------------------------------------------------
GoAgent Version    : 3.1.19 (python/2.7.6 gevent/1.0.1 pyopenssl/0.13)
Uvent Version      : 0.3.0 (pyuv/0.11.0-dev libuv/0.11.2-pre)
Listen Address     : 127.0.0.1:8087
GAE Mode           : https
GAE Profile        : ipv4
GAE APPID          : aaronchansunny
Pac Server         : http://172.24.128.249:8086/proxy.pac
Pac File           : file://E:\下载\goagent-goagent-3591602\local\proxy.pac
------------------------------------------------------
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以知道，goagent监听端口为：&lt;code&gt;127.0.0.1:8087&lt;/code&gt;。那么，剩下的事情就简单了，只要为Git设置代理信息，让Git协议走goagent不就能解决防火墙问题了么。&lt;/p&gt;
&lt;h2 id=&quot;设置Git代理&quot;&gt;&lt;a href=&quot;#设置Git代理&quot; class=&quot;headerlink&quot; title=&quot;设置Git代理&quot;&gt;&lt;/a&gt;设置Git代理&lt;/h2&gt;&lt;p&gt;设置Git代理非常简单，让&lt;code&gt;https_proxy&lt;/code&gt;和&lt;code&gt;http_proxy&lt;/code&gt;走goagent即可。&lt;br&gt;打开Git Bash运行命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ git config --global http.proxy 127.0.0.1:8087
$ git config --global https.proxy 127.0.0.1:8087
$ git config --global http.sslVerify false
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看Git设置信息：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ git config --list
......
http.sslverify=true
http.proxy=127.0.0.1:8087
https.proxy=127.0.0.1:8087
......
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此时通过&lt;code&gt;http&lt;/code&gt;或&lt;code&gt;https&lt;/code&gt;协议&lt;code&gt;git clone&lt;/code&gt;走的就是goagent代理。&lt;br&gt;若想取消代理呢？&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ git config --global --unset http.proxy
$ git config --global --unset https.proxy
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此时再查看Git设置信息，就看不到之前的代理设置了。&lt;br&gt;其实，通过&lt;code&gt;git config&lt;/code&gt;添加设置信息，都是修改&lt;code&gt;~/.gitconfig&lt;/code&gt;文件，上述代理设置也可以直接通过修改该配置文件来完成。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ vi ~/.gitconfig
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置文件内容如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[user]
        name = aaronchansunny
        email = aaronchansunny@gmail.com
[core]
        autocrrlf = false
[http]
        sslVerify = true
        proxy = 127.0.0.1:8087
[https]
        proxy = 127.0.0.1:8087
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以看到，之前的操作相当于在&lt;code&gt;[http]&lt;/code&gt;和&lt;code&gt;[https]&lt;/code&gt;新增相应代理信息。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      给Git设置goagent代理
    
    </summary>
    
    
      <category term="Git" scheme="http://yoursite.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>ST使用Markdown Preview插件实现语法高亮和预览</title>
    <link href="http://yoursite.com/2014/11/16/sublime-plugin-markdown-preview/"/>
    <id>http://yoursite.com/2014/11/16/sublime-plugin-markdown-preview/</id>
    <published>2014-11-15T16:10:21.000Z</published>
    <updated>2016-03-05T05:47:11.158Z</updated>
    
    <content type="html">&lt;h2 id=&quot;引子&quot;&gt;&lt;a href=&quot;#引子&quot; class=&quot;headerlink&quot; title=&quot;引子&quot;&gt;&lt;/a&gt;引子&lt;/h2&gt;&lt;p&gt;关于文本编辑器，一直热衷于Sublime Text（以下简称ST）。不仅仅因为它清爽的界面，更离不开它强大的插件支持。最近用Octpress搭建个人博客，开始学习Markdown标记语言。理所当然，马上想到用ST完成日常Markdown编写。随便打开一个Markdown文件，发现ST并不支持语法高亮。网上搜了下，找到了Markdown Preview，也就是本文的主角。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;##Markdown Preview安装&lt;br&gt;使用Package Control安装Markdown Preview非常简单。打开ST，按下组合键打开控制台:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Control + `
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;注意：第二个组合键并不是单引号，而是Tab键的上一个按键。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;出现控制台后，输入：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import urllib2,os; pf=&amp;apos;Package Control.sublime-package&amp;apos;; ipp = sublime.installed_packages_path(); os.makedirs( ipp ) if not os.path.exists(ipp) else None; urllib2.install_opener( urllib2.build_opener( urllib2.ProxyHandler( ))); open( os.path.join( ipp, pf), &amp;apos;wb&amp;apos; ).write( urllib2.urlopen( &amp;apos;http://sublime.wbond.net/&amp;apos; +pf.replace( &amp;apos; &amp;apos;,&amp;apos;%20&amp;apos; )).read()); print( &amp;apos;Please restart Sublime Text to finish installation&amp;apos;)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;当看到代码最后一行提示的时候说明安装成功。&lt;br&gt;此时重启ST，可在&lt;code&gt;Preferences -&amp;gt; Package Settings&lt;/code&gt;看到&lt;code&gt;Package Control&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;快捷键&quot;&gt;&lt;a href=&quot;#快捷键&quot; class=&quot;headerlink&quot; title=&quot;快捷键&quot;&gt;&lt;/a&gt;快捷键&lt;/h2&gt;&lt;p&gt;ST支持自定义快捷键，Markdown Preview默认没有快捷键。我们可以为Preview in Browser功能设置快捷键。打开&lt;code&gt;Preferences -&amp;gt; Key Bindings User&lt;/code&gt;，在中括号内添加以下代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{ &amp;quot;keys&amp;quot;: [&amp;quot;alt+m&amp;quot;], &amp;quot;command&amp;quot;: &amp;quot;markdown_preview&amp;quot;, &amp;quot;args&amp;quot;: { &amp;quot;target&amp;quot;: &amp;quot;browser&amp;quot;} }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此处设置的快捷键为&lt;code&gt;&amp;quot;alt+m&amp;quot;&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;设置语法高亮和mathjax支持&quot;&gt;&lt;a href=&quot;#设置语法高亮和mathjax支持&quot; class=&quot;headerlink&quot; title=&quot;设置语法高亮和mathjax支持&quot;&gt;&lt;/a&gt;设置语法高亮和mathjax支持&lt;/h2&gt;&lt;p&gt;打开&lt;code&gt;Preferences -&amp;gt;Package Settings-&amp;gt;Markdown Preview-&amp;gt;Setting Default&lt;/code&gt;：&lt;br&gt;查找&lt;code&gt;&amp;quot;enable_mathjax&amp;quot;&lt;/code&gt;和&lt;code&gt;&amp;quot;enable_highlight&amp;quot;&lt;/code&gt;，将其值更改为&lt;code&gt;true&lt;/code&gt;。&lt;br&gt;现在，开始尽情享受在ST下编写Markdown吧。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      Sublime Text使用Markdown Preview插件实现语法高亮和预览
    
    </summary>
    
    
      <category term="Tools" scheme="http://yoursite.com/tags/Tools/"/>
    
  </entry>
  
</feed>
